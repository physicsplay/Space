<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸª GRAVITY ASSIST â€” Mission ATLAS Act 8</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}:root{--void:#030308;--purple:#9b59b6;--cyan:#4ecdc4;--gold:#ffd60a;--red:#e63946;--green:#06d6a0}
    html,body{height:100%;overflow:hidden}body{font-family:'Segoe UI',sans-serif;background:var(--void);color:#f0f4ff}
    .game-container{display:grid;grid-template-columns:1fr 350px;grid-template-rows:auto 1fr auto;height:100vh}
    @media(max-width:900px){.game-container{grid-template-columns:1fr;grid-template-rows:auto 1fr auto auto}}
    .header{grid-column:1/-1;background:rgba(10,10,26,.95);padding:.5rem 1rem;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(155,89,182,.3)}
    .back-btn{background:rgba(155,89,182,.2);border:1px solid rgba(155,89,182,.4);border-radius:8px;padding:.5rem 1rem;color:var(--purple);cursor:pointer}
    .game-title{font-family:'Courier New',monospace}.game-title .act{color:var(--gold);font-size:.8rem}
    .stat-value{font-family:'Courier New',monospace;font-size:1.3rem;color:var(--gold)}.stat-label{font-size:.7rem;color:#888}
    .lang-btn{background:rgba(255,255,255,.1);border:2px solid rgba(255,255,255,.2);border-radius:6px;padding:.25rem .5rem;cursor:pointer}
    .lang-btn.active{background:rgba(255,214,10,.2);border-color:var(--gold)}
    #gameCanvas{display:block;width:100%;height:100%;background:#0a0a1a}
    .control-panel{background:rgba(20,15,30,.98);padding:1rem;overflow-y:auto;border-left:1px solid rgba(155,89,182,.2);display:flex;flex-direction:column;gap:1rem}
    .panel-section{background:rgba(0,0,0,.3);border-radius:12px;padding:1rem;border:1px solid rgba(155,89,182,.2)}
    .section-title{font-family:'Courier New',monospace;color:var(--purple);margin-bottom:.5rem}
    .data-row{display:flex;justify-content:space-between;padding:.25rem 0;font-size:.85rem}.data-label{color:#888}.data-value{font-family:'Courier New',monospace}
    .slider{width:100%;height:8px;-webkit-appearance:none;background:rgba(255,255,255,.1);border-radius:4px}
    .slider::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--purple);cursor:pointer}
    .formula-box{background:rgba(155,89,182,.1);border:1px solid rgba(155,89,182,.3);border-radius:8px;padding:.5rem;margin-bottom:.5rem;text-align:center}
    .formula{font-family:'Courier New',monospace;color:var(--purple)}.formula-note{font-size:.75rem;color:#888}
    .btn{padding:1rem;border:none;border-radius:10px;font-family:'Courier New',monospace;cursor:pointer;width:100%;margin-bottom:.5rem}
    .btn-primary{background:linear-gradient(135deg,#9b59b6,#8e44ad);color:#fff}
    .btn-secondary{background:rgba(255,255,255,.1);color:#fff}.btn-hint{background:rgba(255,214,10,.2);color:var(--gold)}
    .dialogue-box{background:rgba(0,0,0,.5);border-left:3px solid var(--purple);padding:.5rem;font-size:.85rem}
    .footer{grid-column:1/-1;background:rgba(10,10,26,.95);padding:.5rem 1rem;font-size:.8rem;color:#888}
    .modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.9);z-index:1000;display:flex;align-items:center;justify-content:center;padding:2rem}
    .modal-overlay.hidden{opacity:0;pointer-events:none}
    .modal{max-width:700px;width:100%;max-height:90vh;overflow-y:auto;background:linear-gradient(135deg,rgba(30,20,50,.98),rgba(15,10,30,.98));border:2px solid var(--gold);border-radius:20px;padding:2rem}
    .modal-title{font-family:'Courier New',monospace;font-size:1.8rem;text-align:center;color:var(--gold);margin-bottom:1rem}
    .lang-selector-intro{display:flex;justify-content:center;gap:1rem;margin-bottom:2rem}
    .lang-option{display:flex;flex-direction:column;align-items:center;padding:1rem;background:rgba(255,255,255,.05);border:2px solid rgba(255,255,255,.2);border-radius:12px;cursor:pointer;min-width:100px}
    .lang-option.active{background:rgba(255,214,10,.2);border-color:var(--gold)}
    .lang-flag{font-size:2.5rem}.lang-name{font-size:.85rem;color:#888}
    .cinematic-scene{background:rgba(0,0,0,.5);border-radius:12px;padding:1.5rem;margin-bottom:1.5rem;font-family:'Courier New',monospace;line-height:1.8}
    .briefing-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-bottom:1.5rem}
    .briefing-item{background:rgba(0,0,0,.3);border-radius:10px;padding:1rem;text-align:center}
    .briefing-icon{font-size:2rem}.briefing-label{font-size:.8rem;color:#888}.briefing-value{font-family:'Courier New',monospace;color:var(--purple)}
    .modal-btn{display:block;width:100%;padding:1rem;background:linear-gradient(135deg,#ffd700,#ffaa00);border:none;border-radius:12px;font-family:'Courier New',monospace;font-size:1.1rem;color:#000;cursor:pointer;margin-bottom:.5rem}
    .modal-btn.secondary{background:rgba(255,255,255,.1);color:#fff}
    .result-medal{font-size:5rem;text-align:center}.result-title{font-family:'Courier New',monospace;font-size:1.5rem;text-align:center;color:var(--gold)}
    .hidden{display:none!important}
  </style>
</head>
<body>
  <div class="modal-overlay" id="introModal">
    <div class="modal">
      <h1 class="modal-title" id="modalTitle">ğŸª Î’Î‘Î¡Î¥Î¤Î™ÎšÎ— Î£Î¦Î•ÎÎ¤ÎŸÎÎ‘</h1>
      <div class="lang-selector-intro">
        <div class="lang-option" data-lang="el" onclick="setLanguage('el')"><span class="lang-flag">ğŸ‡¬ğŸ‡·</span><span class="lang-name">Î•Î»Î»Î·Î½Î¹ÎºÎ¬</span></div>
        <div class="lang-option active" data-lang="en" onclick="setLanguage('en')"><span class="lang-flag">ğŸ‡¬ğŸ‡§</span><span class="lang-name">English</span></div>
        <div class="lang-option" data-lang="it" onclick="setLanguage('it')"><span class="lang-flag">ğŸ‡®ğŸ‡¹</span><span class="lang-name">Italiano</span></div>
        <div class="lang-option" data-lang="es" onclick="setLanguage('es')"><span class="lang-flag">ğŸ‡ªğŸ‡¸</span><span class="lang-name">EspaÃ±ol</span></div>
        <div class="lang-option" data-lang="bg" onclick="setLanguage('bg')"><span class="lang-flag">ğŸ‡§ğŸ‡¬</span><span class="lang-name">Ğ‘ÑŠĞ»Ğ³Ğ°Ñ€ÑĞºĞ¸</span></div>
        <div class="lang-option" data-lang="pt" onclick="setLanguage('pt')"><span class="lang-flag">ğŸ‡µğŸ‡¹</span><span class="lang-name">PortuguÃªs</span></div>
        <div class="lang-option" data-lang="de" onclick="setLanguage('de')"><span class="lang-flag">ğŸ‡©ğŸ‡ª</span><span class="lang-name">Deutsch</span></div>
        <div class="lang-option" data-lang="fr" onclick="setLanguage('fr')"><span class="lang-flag">ğŸ‡«ğŸ‡·</span><span class="lang-name">FranÃ§ais</span></div>
        <div class="lang-option" data-lang="fi" onclick="setLanguage('fi')"><span class="lang-flag">ğŸ‡«ğŸ‡®</span><span class="lang-name">Suomi</span></div>
      </div>
      <div class="cinematic-scene" id="introScene">Î”ÎµÎ½ Î­Ï‡ÎµÎ¹Ï‚ Î±ÏÎºÎµÏ„Î¬ ÎºÎ±ÏÏƒÎ¹Î¼Î± Î³Î¹Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î®! Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î· Î²Î±ÏÏÏ„Î·Ï„Î± Ï„Î¿Ï… Ï€Î»Î±Î½Î®Ï„Î· Î³Î¹Î± Î½Î± ÎµÏ€Î¹Ï„Î±Ï‡ÏÎ½ÎµÎ¹Ï‚ â€” Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± "ÎºÎ»Î­Î²ÎµÏ„Î±Î¹" Î±Ï€ÏŒ Ï„Î·Î½ ÎºÎ¯Î½Î·ÏƒÎ· Ï„Î¿Ï… Ï€Î»Î±Î½Î®Ï„Î·!</div>
      <div class="briefing-grid">
        <div class="briefing-item"><div class="briefing-icon">ğŸš€</div><div class="briefing-label" id="bl1">Î‘ÏÏ‡Î¹ÎºÎ® Î¤Î±Ï‡ÏÏ„Î·Ï„Î±</div><div class="briefing-value">vâ‚ = 8 km/s</div></div>
        <div class="briefing-item"><div class="briefing-icon">ğŸ¯</div><div class="briefing-label" id="bl2">Î£Ï„ÏŒÏ‡Î¿Ï‚</div><div class="briefing-value">vâ‚‚ â‰¥ 16 km/s</div></div>
        <div class="briefing-item"><div class="briefing-icon">ğŸª</div><div class="briefing-label" id="bl3">Î¤Î±Ï‡. Î Î»Î±Î½Î®Ï„Î·</div><div class="briefing-value">V = 13 km/s</div></div>
        <div class="briefing-item"><div class="briefing-icon">ğŸ“</div><div class="briefing-label" id="bl4">Î“Ï‰Î½Î¯Î±</div><div class="briefing-value">Î¸ = 30Â° - 150Â°</div></div>
      </div>
      <button class="modal-btn" id="startBtn" onclick="startGame()">ğŸª Î•ÎÎ‘Î¡ÎÎ—</button>
    </div>
  </div>
  <div class="modal-overlay hidden" id="endModal">
    <div class="modal">
      <div class="result-medal" id="resultMedal">ğŸ¥‡</div>
      <h2 class="result-title" id="resultTitle">Î•Î Î™Î¤Î¥Î§Î™Î‘!</h2>
      <div class="cinematic-scene" id="endCinematic"></div>
      <button class="modal-btn" id="nextBtn" onclick="goNext()">Î•Î ÎŸÎœÎ•ÎÎ— Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î—</button>
      <button class="modal-btn secondary" id="retryBtn" onclick="retry()">ÎÎ‘ÎÎ‘Î”ÎŸÎšÎ™ÎœÎ‘Î£Î•</button>
    </div>
  </div>
  <div class="game-container">
    <header class="header">
      <div style="display:flex;align-items:center;gap:1rem">
        <button class="back-btn" id="backBtn" onclick="goBack()">â† Î Î™Î£Î©</button>
        <div class="game-title"><div class="act">ACT 8</div>GRAVITY ASSIST</div>
      </div>
      <div style="display:flex;gap:2rem">
        <div class="stat-box"><div class="stat-value" id="attemptsDisplay">0</div><div class="stat-label" id="attemptsLabel">Î Î¡ÎŸÎ£Î Î‘Î˜Î•Î™Î•Î£</div></div>
        <div class="stat-box"><div class="stat-value" id="scoreDisplay">100</div><div class="stat-label" id="scoreLabel">Î’Î‘Î˜ÎœÎŸÎ£</div></div>
      </div>
      <div style="display:flex;gap:.5rem">
        <button class="lang-btn" data-lang="el" onclick="setLanguage('el')">ğŸ‡¬ğŸ‡·</button>
        <button class="lang-btn active" data-lang="en" onclick="setLanguage('en')">ğŸ‡¬ğŸ‡§</button>
        <button class="lang-btn" data-lang="it" onclick="setLanguage('it')">ğŸ‡®ğŸ‡¹</button>
        <button class="lang-btn" data-lang="es" onclick="setLanguage('es')">ğŸ‡ªğŸ‡¸</button>
        <button class="lang-btn" data-lang="bg" onclick="setLanguage('bg')">ğŸ‡§ğŸ‡¬</button>
        <button class="lang-btn" data-lang="pt" onclick="setLanguage('pt')">ğŸ‡µğŸ‡¹</button>
        <button class="lang-btn" data-lang="de" onclick="setLanguage('de')">ğŸ‡©ğŸ‡ª</button>
        <button class="lang-btn" data-lang="fr" onclick="setLanguage('fr')">ğŸ‡«ğŸ‡·</button>
        <button class="lang-btn" data-lang="fi" onclick="setLanguage('fi')">ğŸ‡«ğŸ‡®</button>
      </div>
    </header>
    <div><canvas id="gameCanvas"></canvas></div>
    <div class="control-panel">
      <div class="panel-section">
        <div class="section-title" id="dataTitle">ğŸ“Š Î”Î•Î”ÎŸÎœÎ•ÎÎ‘</div>
        <div class="data-row"><span class="data-label" id="dl1">Î‘ÏÏ‡Î¹ÎºÎ® Ï„Î±Ï‡ÏÏ„Î·Ï„Î± (vâ‚):</span><span class="data-value">8 km/s</span></div>
        <div class="data-row"><span class="data-label" id="dl2">Î¤Î±Ï‡ÏÏ„Î·Ï„Î± Ï€Î»Î±Î½Î®Ï„Î· (V):</span><span class="data-value">13 km/s</span></div>
        <div class="data-row"><span class="data-label" id="dl3">Î£Ï„ÏŒÏ‡Î¿Ï‚ (vâ‚‚):</span><span class="data-value">â‰¥ 16 km/s</span></div>
        <div class="data-row"><span class="data-label" id="dl4">Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎ± vâ‚‚:</span><span class="data-value" id="currentV">-- km/s</span></div>
      </div>
      <div class="panel-section">
        <div class="section-title" id="angleTitle">ğŸ¯ Î“Î©ÎÎ™Î‘ Î Î¡ÎŸÎ£Î•Î“Î“Î™Î£Î—Î£</div>
        <div style="display:flex;justify-content:space-between;margin-bottom:.5rem"><span id="angleLabel">Î“Ï‰Î½Î¯Î± Î¸:</span><span id="angleDisplay">30Â°</span></div>
        <input type="range" class="slider" id="angleSlider" min="30" max="150" value="30">
      </div>
      <div class="panel-section">
        <div class="section-title" id="physicsTitle">ğŸ“ Î¦Î¥Î£Î™ÎšÎ—</div>
        <div class="formula-box"><div class="formula">Î”v = 2VÂ·sin(Î¸/2)</div><div class="formula-note" id="fn1">ÎœÎµÏ„Î±Î²Î¿Î»Î® Ï„Î±Ï‡ÏÏ„Î·Ï„Î±Ï‚</div></div>
        <div class="formula-box"><div class="formula">Î”E = Â½m(vâ‚‚Â²-vâ‚Â²)</div><div class="formula-note" id="fn2">ÎœÎµÏ„Î±Î²Î¿Î»Î® ÎºÎ¹Î½. ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±Ï‚</div></div>
      </div>
      <div class="panel-section">
        <button class="btn btn-primary" id="executeBtn" onclick="execute()">ğŸš€ Î•ÎšÎ¤Î•Î›Î•Î£Î— Î•Î›Î™Î“ÎœÎŸÎ¥</button>
        <button class="btn btn-secondary" id="resetBtn" onclick="reset()">â†º Î•Î Î‘ÎÎ‘Î¦ÎŸÎ¡Î‘</button>
        <button class="btn btn-hint" id="hintBtn" onclick="hint()">ğŸ’¡ Î¥Î ÎŸÎ”Î•Î™ÎÎ—</button>
      </div>
      <div class="panel-section"><div class="dialogue-box" id="dialogueText">Î¡ÏÎ¸Î¼Î¹ÏƒÎµ Ï„Î· Î³Ï‰Î½Î¯Î± Î³Î¹Î± Î½Î± ÎºÎµÏÎ´Î¯ÏƒÎµÎ¹Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î±Ï€ÏŒ Ï„Î¿Î½ Ï€Î»Î±Î½Î®Ï„Î·!</div></div>
    </div>
    <footer class="footer" id="footerText">SPACE: Î•ÎºÏ„Î­Î»ÎµÏƒÎ· | R: Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ | Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Î•Î½Î­ÏÎ³ÎµÎ¹Î±Ï‚</footer>
  </div>
  <script>
    const I18N = {
      el: {
        modalTitle: "ğŸª Î’Î‘Î¡Î¥Î¤Î™ÎšÎ— Î£Î¦Î•ÎÎ¤ÎŸÎÎ‘", introScene: "Î”ÎµÎ½ Î­Ï‡ÎµÎ¹Ï‚ Î±ÏÎºÎµÏ„Î¬ ÎºÎ±ÏÏƒÎ¹Î¼Î± Î³Î¹Î± ÎµÏ€Î¹ÏƒÏ„ÏÎ¿Ï†Î®! Î§ÏÎ·ÏƒÎ¹Î¼Î¿Ï€Î¿Î¯Î·ÏƒÎµ Ï„Î· Î²Î±ÏÏÏ„Î·Ï„Î± Ï„Î¿Ï… Ï€Î»Î±Î½Î®Ï„Î· Î³Î¹Î± Î½Î± ÎµÏ€Î¹Ï„Î±Ï‡ÏÎ½ÎµÎ¹Ï‚ â€” Î· ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± \"ÎºÎ»Î­Î²ÎµÏ„Î±Î¹\" Î±Ï€ÏŒ Ï„Î·Î½ ÎºÎ¯Î½Î·ÏƒÎ· Ï„Î¿Ï… Ï€Î»Î±Î½Î®Ï„Î·!",
        bl1: "Î‘ÏÏ‡Î¹ÎºÎ® Î¤Î±Ï‡ÏÏ„Î·Ï„Î±", bl2: "Î£Ï„ÏŒÏ‡Î¿Ï‚", bl3: "Î¤Î±Ï‡. Î Î»Î±Î½Î®Ï„Î·", bl4: "Î“Ï‰Î½Î¯Î±",
        startBtn: "ğŸª Î•ÎÎ‘Î¡ÎÎ—", backBtn: "â† Î Î™Î£Î©", attemptsLabel: "Î Î¡ÎŸÎ£Î Î‘Î˜Î•Î™Î•Î£", scoreLabel: "Î’Î‘Î˜ÎœÎŸÎ£",
        dataTitle: "ğŸ“Š Î”Î•Î”ÎŸÎœÎ•ÎÎ‘", dl1: "Î‘ÏÏ‡Î¹ÎºÎ® Ï„Î±Ï‡ÏÏ„Î·Ï„Î± (vâ‚):", dl2: "Î¤Î±Ï‡ÏÏ„Î·Ï„Î± Ï€Î»Î±Î½Î®Ï„Î· (V):", dl3: "Î£Ï„ÏŒÏ‡Î¿Ï‚ (vâ‚‚):", dl4: "Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎ± vâ‚‚:",
        angleTitle: "ğŸ¯ Î“Î©ÎÎ™Î‘ Î Î¡ÎŸÎ£Î•Î“Î“Î™Î£Î—Î£", angleLabel: "Î“Ï‰Î½Î¯Î± Î¸:", physicsTitle: "ğŸ“ Î¦Î¥Î£Î™ÎšÎ—",
        fn1: "ÎœÎµÏ„Î±Î²Î¿Î»Î® Ï„Î±Ï‡ÏÏ„Î·Ï„Î±Ï‚", fn2: "ÎœÎµÏ„Î±Î²Î¿Î»Î® ÎºÎ¹Î½. ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±Ï‚",
        executeBtn: "ğŸš€ Î•ÎšÎ¤Î•Î›Î•Î£Î— Î•Î›Î™Î“ÎœÎŸÎ¥", resetBtn: "â†º Î•Î Î‘ÎÎ‘Î¦ÎŸÎ¡Î‘", hintBtn: "ğŸ’¡ Î¥Î ÎŸÎ”Î•Î™ÎÎ—",
        dialogueReady: "Î¡ÏÎ¸Î¼Î¹ÏƒÎµ Ï„Î· Î³Ï‰Î½Î¯Î± Î³Î¹Î± Î½Î± ÎºÎµÏÎ´Î¯ÏƒÎµÎ¹Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î± Î±Ï€ÏŒ Ï„Î¿Î½ Ï€Î»Î±Î½Î®Ï„Î·!",
        dialogueHint: "Î£ÎºÎ­ÏˆÎ¿Ï…: Î”v = 2VÂ·sin(Î¸/2). Î¤Î¹ Î³Î¯Î½ÎµÏ„Î±Î¹ ÏŒÏ„Î±Î½ Ï„Î¿ sin(Î¸/2) Î¼ÎµÎ³Î±Î»ÏÎ½ÎµÎ¹; Î Î¿Î¹Î± Î³Ï‰Î½Î¯Î± Î¸Î± Î´ÏÏƒÎµÎ¹ Î¼Î­Î³Î¹ÏƒÏ„Î¿ sin;",
        footerText: "SPACE: Î•ÎºÏ„Î­Î»ÎµÏƒÎ· | R: Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬ | Î”Î¹Î±Ï„Î®ÏÎ·ÏƒÎ· Î•Î½Î­ÏÎ³ÎµÎ¹Î±Ï‚",
        resultSuccess: "Î•Î Î™Î¤Î¥Î§Î—Î£ Î£Î¦Î•ÎÎ¤ÎŸÎÎ‘!", resultFail: "Î‘ÎÎ•Î Î‘Î¡ÎšÎ—Î£ Î¤Î‘Î§Î¥Î¤Î—Î¤Î‘",
        endSuccess: "ÎšÎ­ÏÎ´Î¿Ï‚ ÎµÎ½Î­ÏÎ³ÎµÎ¹Î±Ï‚ Î±Ï€ÏŒ Ï„Î¿Î½ Ï€Î»Î±Î½Î®Ï„Î·!", endFail: "Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¼ÎµÎ³Î±Î»ÏÏ„ÎµÏÎ· Î³Ï‰Î½Î¯Î±!",
        nextBtn: "Î•Î ÎŸÎœÎ•ÎÎ— Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î—", retryBtn: "ÎÎ‘ÎÎ‘Î”ÎŸÎšÎ™ÎœÎ‘Î£Î•", finalV: "Î¤ÎµÎ»Î¹ÎºÎ® Ï„Î±Ï‡ÏÏ„Î·Ï„Î±"
      },
      en: {
        modalTitle: "ğŸª GRAVITY SLINGSHOT", introScene: "Not enough fuel to return! Use the planet's gravity to accelerate â€” energy is \"stolen\" from the planet's motion!",
        bl1: "Initial Velocity", bl2: "Target", bl3: "Planet Velocity", bl4: "Angle",
        startBtn: "ğŸª START", backBtn: "â† BACK", attemptsLabel: "ATTEMPTS", scoreLabel: "SCORE",
        dataTitle: "ğŸ“Š DATA", dl1: "Initial velocity (vâ‚):", dl2: "Planet velocity (V):", dl3: "Target (vâ‚‚):", dl4: "Current vâ‚‚:",
        angleTitle: "ğŸ¯ APPROACH ANGLE", angleLabel: "Angle Î¸:", physicsTitle: "ğŸ“ PHYSICS",
        fn1: "Velocity change", fn2: "Kinetic energy change",
        executeBtn: "ğŸš€ EXECUTE MANEUVER", resetBtn: "â†º RESET", hintBtn: "ğŸ’¡ HINT",
        dialogueReady: "Adjust the angle to gain energy from the planet!",
        dialogueHint: "Think: Î”v = 2VÂ·sin(Î¸/2). What happens when sin(Î¸/2) increases? Which angle maximizes sin?",
        footerText: "SPACE: Execute | R: Reset | Energy Conservation",
        resultSuccess: "SUCCESSFUL SLINGSHOT!", resultFail: "INSUFFICIENT VELOCITY",
        endSuccess: "Energy gained from the planet!", endFail: "Try a larger angle!",
        nextBtn: "NEXT MISSION", retryBtn: "TRY AGAIN", finalV: "Final velocity"
      },
      it: {
        modalTitle: "ğŸª FIONDA GRAVITAZIONALE", introScene: "Carburante insufficiente per tornare! Usa la gravitÃ  del pianeta per accelerare â€” l'energia viene \"rubata\" dal moto del pianeta!",
        bl1: "VelocitÃ  Iniziale", bl2: "Obiettivo", bl3: "VelocitÃ  Pianeta", bl4: "Angolo",
        startBtn: "ğŸª INIZIA", backBtn: "â† INDIETRO", attemptsLabel: "TENTATIVI", scoreLabel: "PUNTEGGIO",
        dataTitle: "ğŸ“Š DATI", dl1: "VelocitÃ  iniziale (vâ‚):", dl2: "VelocitÃ  pianeta (V):", dl3: "Obiettivo (vâ‚‚):", dl4: "vâ‚‚ attuale:",
        angleTitle: "ğŸ¯ ANGOLO DI APPROCCIO", angleLabel: "Angolo Î¸:", physicsTitle: "ğŸ“ FISICA",
        fn1: "Variazione velocitÃ ", fn2: "Variazione energia cinetica",
        executeBtn: "ğŸš€ ESEGUI MANOVRA", resetBtn: "â†º RICOMINCIA", hintBtn: "ğŸ’¡ SUGGERIMENTO",
        dialogueReady: "Regola l'angolo per guadagnare energia dal pianeta!",
        dialogueHint: "Pensa: Î”v = 2VÂ·sin(Î¸/2). Cosa succede quando sin(Î¸/2) aumenta? Quale angolo massimizza il sin?",
        footerText: "SPACE: Esegui | R: Ricomincia | Conservazione Energia",
        resultSuccess: "FIONDA RIUSCITA!", resultFail: "VELOCITÃ€ INSUFFICIENTE",
        endSuccess: "Energia guadagnata dal pianeta!", endFail: "Prova un angolo maggiore!",
        nextBtn: "PROSSIMA MISSIONE", retryBtn: "RIPROVA", finalV: "VelocitÃ  finale"
      },
      es: {
        modalTitle: "ğŸª HONDA GRAVITACIONAL", introScene: "Â¡No hay suficiente combustible para volver! Usa la gravedad del planeta para acelerar â€” Â¡la energÃ­a se \"roba\" del movimiento del planeta!",
        bl1: "Velocidad Inicial", bl2: "Objetivo", bl3: "Velocidad Planeta", bl4: "Ãngulo",
        startBtn: "ğŸª INICIAR", backBtn: "â† ATRÃS", attemptsLabel: "INTENTOS", scoreLabel: "PUNTOS",
        dataTitle: "ğŸ“Š DATOS", dl1: "Velocidad inicial (vâ‚):", dl2: "Velocidad planeta (V):", dl3: "Objetivo (vâ‚‚):", dl4: "vâ‚‚ actual:",
        angleTitle: "ğŸ¯ ÃNGULO DE APROXIMACIÃ“N", angleLabel: "Ãngulo Î¸:", physicsTitle: "ğŸ“ FÃSICA",
        fn1: "Cambio de velocidad", fn2: "Cambio de energÃ­a cinÃ©tica",
        executeBtn: "ğŸš€ EJECUTAR MANIOBRA", resetBtn: "â†º REINICIAR", hintBtn: "ğŸ’¡ PISTA",
        dialogueReady: "Â¡Ajusta el Ã¡ngulo para ganar energÃ­a del planeta!",
        dialogueHint: "Piensa: Î”v = 2VÂ·sin(Î¸/2). Â¿QuÃ© pasa cuando sin(Î¸/2) aumenta? Â¿QuÃ© Ã¡ngulo maximiza sin?",
        footerText: "SPACE: Ejecutar | R: Reiniciar | ConservaciÃ³n de EnergÃ­a",
        resultSuccess: "Â¡HONDA EXITOSA!", resultFail: "VELOCIDAD INSUFICIENTE",
        endSuccess: "Â¡EnergÃ­a ganada del planeta!", endFail: "Â¡Prueba un Ã¡ngulo mayor!",
        nextBtn: "SIGUIENTE MISIÃ“N", retryBtn: "REINTENTAR", finalV: "Velocidad final"
      },
      de: {
        modalTitle: "ğŸª SCHWERKRAFTSCHLEUDER", introScene: "Nicht genug Treibstoff fÃ¼r die RÃ¼ckkehr! Nutze die Gravitation des Planeten zur Beschleunigung â€” Energie wird von der Planetenbewegung \"gestohlen\"!",
        bl1: "Anfangsgeschwindigkeit", bl2: "Ziel", bl3: "Planetengeschwindigkeit", bl4: "Winkel",
        startBtn: "ğŸª START", backBtn: "â† ZURÃœCK", attemptsLabel: "VERSUCHE", scoreLabel: "PUNKTE",
        dataTitle: "ğŸ“Š DATEN", dl1: "Anfangsgeschwindigkeit (vâ‚):", dl2: "Planetengeschwindigkeit (V):", dl3: "Ziel (vâ‚‚):", dl4: "Aktuell vâ‚‚:",
        angleTitle: "ğŸ¯ ANNÃ„HERUNGSWINKEL", angleLabel: "Winkel Î¸:", physicsTitle: "ğŸ“ PHYSIK",
        fn1: "GeschwindigkeitsÃ¤nderung", fn2: "Ã„nderung kinetischer Energie",
        executeBtn: "ğŸš€ MANÃ–VER AUSFÃœHREN", resetBtn: "â†º NEUSTART", hintBtn: "ğŸ’¡ HINWEIS",
        dialogueReady: "Stelle den Winkel ein um Energie vom Planeten zu gewinnen!",
        dialogueHint: "Denke: Î”v = 2VÂ·sin(Î¸/2). Was passiert wenn sin(Î¸/2) grÃ¶ÃŸer wird? Welcher Winkel maximiert sin?",
        footerText: "SPACE: AusfÃ¼hren | R: Neustart | Energieerhaltung",
        resultSuccess: "ERFOLGREICHE SCHLEUDER!", resultFail: "UNGENÃœGENDE GESCHWINDIGKEIT",
        endSuccess: "Energie vom Planeten gewonnen!", endFail: "Versuche einen grÃ¶ÃŸeren Winkel!",
        nextBtn: "NÃ„CHSTE MISSION", retryBtn: "NOCHMAL", finalV: "Endgeschwindigkeit"
      },
      fr: {
        modalTitle: "ğŸª FRONDE GRAVITATIONNELLE", introScene: "Pas assez de carburant pour revenir! Utilise la gravitÃ© de la planÃ¨te pour accÃ©lÃ©rer â€” l'Ã©nergie est \"volÃ©e\" au mouvement de la planÃ¨te!",
        bl1: "Vitesse Initiale", bl2: "Objectif", bl3: "Vitesse PlanÃ¨te", bl4: "Angle",
        startBtn: "ğŸª DÃ‰MARRER", backBtn: "â† RETOUR", attemptsLabel: "ESSAIS", scoreLabel: "SCORE",
        dataTitle: "ğŸ“Š DONNÃ‰ES", dl1: "Vitesse initiale (vâ‚):", dl2: "Vitesse planÃ¨te (V):", dl3: "Objectif (vâ‚‚):", dl4: "vâ‚‚ actuel:",
        angleTitle: "ğŸ¯ ANGLE D'APPROCHE", angleLabel: "Angle Î¸:", physicsTitle: "ğŸ“ PHYSIQUE",
        fn1: "Changement de vitesse", fn2: "Changement d'Ã©nergie cinÃ©tique",
        executeBtn: "ğŸš€ EXÃ‰CUTER MANÅ’UVRE", resetBtn: "â†º RECOMMENCER", hintBtn: "ğŸ’¡ INDICE",
        dialogueReady: "Ajuste l'angle pour gagner de l'Ã©nergie de la planÃ¨te!",
        dialogueHint: "Pense: Î”v = 2VÂ·sin(Î¸/2). Que se passe-t-il quand sin(Î¸/2) augmente? Quel angle maximise sin?",
        footerText: "SPACE: ExÃ©cuter | R: Recommencer | Conservation d'Ã‰nergie",
        resultSuccess: "FRONDE RÃ‰USSIE!", resultFail: "VITESSE INSUFFISANTE",
        endSuccess: "Ã‰nergie gagnÃ©e de la planÃ¨te!", endFail: "Essaie un angle plus grand!",
        nextBtn: "MISSION SUIVANTE", retryBtn: "RÃ‰ESSAYER", finalV: "Vitesse finale"
      },
      bg: {
        modalTitle: "ğŸª Ğ“Ğ ĞĞ’Ğ˜Ğ¢ĞĞ¦Ğ˜ĞĞĞĞ ĞŸĞ ĞĞ¨ĞšĞ", introScene: "ĞÑĞ¼Ğ° Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚ÑŠÑ‡Ğ½Ğ¾ Ğ³Ğ¾Ñ€Ğ¸Ğ²Ğ¾ Ğ·Ğ° Ğ²Ñ€ÑŠÑ‰Ğ°Ğ½Ğµ! Ğ˜Ğ·Ğ¿Ğ¾Ğ»Ğ·Ğ²Ğ°Ğ¹ Ğ³Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ°Ñ†Ğ¸ÑÑ‚Ğ° Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½ĞµÑ‚Ğ°Ñ‚Ğ° Ğ·Ğ° ÑƒÑĞºĞ¾Ñ€ÑĞ²Ğ°Ğ½Ğµ â€” ĞµĞ½ĞµÑ€Ğ³Ğ¸ÑÑ‚Ğ° ÑĞµ \"ĞºÑ€Ğ°Ğ´Ğµ\" Ğ¾Ñ‚ Ğ´Ğ²Ğ¸Ğ¶ĞµĞ½Ğ¸ĞµÑ‚Ğ¾ Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½ĞµÑ‚Ğ°Ñ‚Ğ°!",
        bl1: "ĞĞ°Ñ‡Ğ°Ğ»Ğ½Ğ° Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚", bl2: "Ğ¦ĞµĞ»", bl3: "Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ Ğ½Ğ° ĞŸĞ»Ğ°Ğ½ĞµÑ‚Ğ°Ñ‚Ğ°", bl4: "ĞªĞ³ÑŠĞ»",
        startBtn: "ğŸª Ğ¡Ğ¢ĞĞ Ğ¢", backBtn: "â† ĞĞĞ—ĞĞ”", attemptsLabel: "ĞĞŸĞ˜Ğ¢Ğ˜", scoreLabel: "Ğ¢ĞĞ§ĞšĞ˜",
        dataTitle: "ğŸ“Š Ğ”ĞĞĞĞ˜", dl1: "ĞĞ°Ñ‡Ğ°Ğ»Ğ½Ğ° ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ (vâ‚):", dl2: "Ğ¡ĞºĞ¾Ñ€Ğ¾ÑÑ‚ Ğ½Ğ° Ğ¿Ğ»Ğ°Ğ½ĞµÑ‚Ğ° (V):", dl3: "Ğ¦ĞµĞ» (vâ‚‚):", dl4: "Ğ¢ĞµĞºÑƒÑ‰Ğ¾ vâ‚‚:",
        angleTitle: "ğŸ¯ ĞªĞ“ĞªĞ› ĞĞ ĞŸĞ Ğ˜Ğ‘Ğ›Ğ˜Ğ–ĞĞ’ĞĞĞ•", angleLabel: "ĞªĞ³ÑŠĞ» Î¸:", physicsTitle: "ğŸ“ Ğ¤Ğ˜Ğ—Ğ˜ĞšĞ",
        fn1: "ĞŸÑ€Ğ¾Ğ¼ÑĞ½Ğ° Ğ½Ğ° ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚Ñ‚Ğ°", fn2: "ĞŸÑ€Ğ¾Ğ¼ÑĞ½Ğ° Ğ½Ğ° ĞºĞ¸Ğ½ĞµÑ‚Ğ¸Ñ‡Ğ½Ğ° ĞµĞ½ĞµÑ€Ğ³Ğ¸Ñ",
        executeBtn: "ğŸš€ Ğ˜Ğ—ĞŸĞªĞ›ĞĞ˜ ĞœĞĞĞ¬ĞĞ’ĞªĞ ", resetBtn: "â†º Ğ Ğ•Ğ¡Ğ¢ĞĞ Ğ¢", hintBtn: "ğŸ’¡ ĞŸĞĞ”Ğ¡ĞšĞĞ—ĞšĞ",
        dialogueReady: "ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ ÑŠĞ³ÑŠĞ»Ğ° Ğ·Ğ° Ğ´Ğ° ÑĞ¿ĞµÑ‡ĞµĞ»Ğ¸Ñˆ ĞµĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ¾Ñ‚ Ğ¿Ğ»Ğ°Ğ½ĞµÑ‚Ğ°Ñ‚Ğ°!",
        dialogueHint: "ĞŸĞ¾Ğ¼Ğ¸ÑĞ»Ğ¸: Î”v = 2VÂ·sin(Î¸/2). ĞšĞ°ĞºĞ²Ğ¾ ÑÑ‚Ğ°Ğ²Ğ° ĞºĞ¾Ğ³Ğ°Ñ‚Ğ¾ sin(Î¸/2) Ñ€Ğ°ÑÑ‚Ğµ? ĞšĞ¾Ğ¹ ÑŠĞ³ÑŠĞ» Ğ¼Ğ°ĞºÑĞ¸Ğ¼Ğ¸Ğ·Ğ¸Ñ€Ğ° sin?",
        footerText: "SPACE: Ğ˜Ğ·Ğ¿ÑŠĞ»Ğ½Ğ¸ | R: Ğ ĞµÑÑ‚Ğ°Ñ€Ñ‚ | Ğ—Ğ°Ğ¿Ğ°Ğ·Ğ²Ğ°Ğ½Ğµ Ğ½Ğ° Ğ•Ğ½ĞµÑ€Ğ³Ğ¸Ñ",
        resultSuccess: "Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ ĞŸĞ ĞĞ¨ĞšĞ!", resultFail: "ĞĞ•Ğ”ĞĞ¡Ğ¢ĞĞ¢ĞªĞ§ĞĞ Ğ¡ĞšĞĞ ĞĞ¡Ğ¢",
        endSuccess: "Ğ¡Ğ¿ĞµÑ‡ĞµĞ»ĞµĞ½Ğ° ĞµĞ½ĞµÑ€Ğ³Ğ¸Ñ Ğ¾Ñ‚ Ğ¿Ğ»Ğ°Ğ½ĞµÑ‚Ğ°Ñ‚Ğ°!", endFail: "ĞĞ¿Ğ¸Ñ‚Ğ°Ğ¹ Ğ¿Ğ¾-Ğ³Ğ¾Ğ»ÑĞ¼ ÑŠĞ³ÑŠĞ»!",
        nextBtn: "Ğ¡Ğ›Ğ•Ğ”Ğ’ĞĞ©Ğ ĞœĞ˜Ğ¡Ğ˜Ğ¯", retryBtn: "ĞĞŸĞ˜Ğ¢ĞĞ™ ĞĞ¢ĞĞĞ’Ğ", finalV: "ĞšÑ€Ğ°Ğ¹Ğ½Ğ° ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚"
      },
      pt: {
        modalTitle: "ğŸª ESTILINGUE GRAVITACIONAL", introScene: "CombustÃ­vel insuficiente para voltar! Use a gravidade do planeta para acelerar â€” a energia Ã© \"roubada\" do movimento do planeta!",
        bl1: "Velocidade Inicial", bl2: "Alvo", bl3: "Velocidade Planeta", bl4: "Ã‚ngulo",
        startBtn: "ğŸª INICIAR", backBtn: "â† VOLTAR", attemptsLabel: "TENTATIVAS", scoreLabel: "PONTOS",
        dataTitle: "ğŸ“Š DADOS", dl1: "Velocidade inicial (vâ‚):", dl2: "Velocidade planeta (V):", dl3: "Alvo (vâ‚‚):", dl4: "vâ‚‚ atual:",
        angleTitle: "ğŸ¯ Ã‚NGULO DE APROXIMAÃ‡ÃƒO", angleLabel: "Ã‚ngulo Î¸:", physicsTitle: "ğŸ“ FÃSICA",
        fn1: "MudanÃ§a de velocidade", fn2: "MudanÃ§a de energia cinÃ©tica",
        executeBtn: "ğŸš€ EXECUTAR MANOBRA", resetBtn: "â†º REINICIAR", hintBtn: "ğŸ’¡ DICA",
        dialogueReady: "Ajuste o Ã¢ngulo para ganhar energia do planeta!",
        dialogueHint: "Pense: Î”v = 2VÂ·sin(Î¸/2). O que acontece quando sin(Î¸/2) aumenta? Qual Ã¢ngulo maximiza sin?",
        footerText: "SPACE: Executar | R: Reiniciar | ConservaÃ§Ã£o de Energia",
        resultSuccess: "ESTILINGUE BEM-SUCEDIDO!", resultFail: "VELOCIDADE INSUFICIENTE",
        endSuccess: "Energia ganha do planeta!", endFail: "Tente um Ã¢ngulo maior!",
        nextBtn: "PRÃ“XIMA MISSÃƒO", retryBtn: "TENTAR NOVAMENTE", finalV: "Velocidade final"
      },
      fi: {
        modalTitle: "ğŸª PAINOVOIMALINKO", introScene: "Polttoaine ei riitÃ¤ paluuseen! KÃ¤ytÃ¤ planeetan painovoimaa kiihdytykseen â€” energia \"varastetaan\" planeetan liikkeestÃ¤!",
        bl1: "Alkunopeus", bl2: "Tavoite", bl3: "Planeetan Nopeus", bl4: "Kulma",
        startBtn: "ğŸª ALOITA", backBtn: "â† TAKAISIN", attemptsLabel: "YRITYKSET", scoreLabel: "PISTEET",
        dataTitle: "ğŸ“Š TIEDOT", dl1: "Alkunopeus (vâ‚):", dl2: "Planeetan nopeus (V):", dl3: "Tavoite (vâ‚‚):", dl4: "Nykyinen vâ‚‚:",
        angleTitle: "ğŸ¯ LÃ„HESTYMISKULMA", angleLabel: "Kulma Î¸:", physicsTitle: "ğŸ“ FYSIIKKA",
        fn1: "Nopeuden muutos", fn2: "Liike-energian muutos",
        executeBtn: "ğŸš€ SUORITA LIIKE", resetBtn: "â†º ALUSTA", hintBtn: "ğŸ’¡ VIHJE",
        dialogueReady: "SÃ¤Ã¤dÃ¤ kulma saadaksesi energiaa planeetasta!",
        dialogueHint: "Ajattele: Î”v = 2VÂ·sin(Î¸/2). MitÃ¤ tapahtuu kun sin(Î¸/2) kasvaa? MikÃ¤ kulma maksimoi sin:n?",
        footerText: "SPACE: Suorita | R: Alusta | Energian SÃ¤ilyminen",
        resultSuccess: "ONNISTUNUT LINKO!", resultFail: "RIITTÃ„MÃ„TÃ–N NOPEUS",
        endSuccess: "Energiaa saatu planeetasta!", endFail: "Kokeile suurempaa kulmaa!",
        nextBtn: "SEURAAVA TEHTÃ„VÃ„", retryBtn: "YRITÃ„ UUDELLEEN", finalV: "Loppunopeus"
      }
    };
    
    let state = {lang:'en', phase:'intro', attempts:0, score:100, angle:30, v1:8, V:13, TARGET:16, shipAngle:0, anim:false};
    const $ = id => document.getElementById(id);
    const canvas = $('gameCanvas'), ctx = canvas.getContext('2d');
    
    function t(key) { return I18N[state.lang][key] || key; }
    
    function setLanguage(lang) {
      state.lang = lang;
      localStorage.setItem('atlas_language', lang);
      document.querySelectorAll('.lang-btn').forEach(b => b.classList.toggle('active', b.dataset.lang === lang));
      document.querySelectorAll('.lang-option').forEach(o => o.classList.toggle('active', o.dataset.lang === lang));
      updateAllText();
    }
    
    function updateAllText() {
      $('modalTitle').textContent = t('modalTitle'); $('introScene').textContent = t('introScene');
      $('bl1').textContent = t('bl1'); $('bl2').textContent = t('bl2'); $('bl3').textContent = t('bl3'); $('bl4').textContent = t('bl4');
      $('startBtn').textContent = t('startBtn'); $('backBtn').textContent = t('backBtn');
      $('attemptsLabel').textContent = t('attemptsLabel'); $('scoreLabel').textContent = t('scoreLabel');
      $('dataTitle').textContent = t('dataTitle');
      $('dl1').textContent = t('dl1'); $('dl2').textContent = t('dl2'); $('dl3').textContent = t('dl3'); $('dl4').textContent = t('dl4');
      $('angleTitle').textContent = t('angleTitle'); $('angleLabel').textContent = t('angleLabel');
      $('physicsTitle').textContent = t('physicsTitle'); $('fn1').textContent = t('fn1'); $('fn2').textContent = t('fn2');
      $('executeBtn').textContent = t('executeBtn'); $('resetBtn').textContent = t('resetBtn'); $('hintBtn').textContent = t('hintBtn');
      $('dialogueText').textContent = t('dialogueReady'); $('footerText').textContent = t('footerText');
      $('nextBtn').textContent = t('nextBtn'); $('retryBtn').textContent = t('retryBtn');
    }
    
    function resize() { canvas.width = canvas.parentElement.clientWidth; canvas.height = canvas.parentElement.clientHeight; }
    function calcDv(a) { return 2 * state.V * Math.sin((a * Math.PI / 180) / 2); }
    
    function render() {
      const W = canvas.width, H = canvas.height, cx = W/2, cy = H/2;
      ctx.fillStyle = '#0a0a1a'; ctx.fillRect(0, 0, W, H);
      for (let i = 0; i < 80; i++) { ctx.fillStyle = `rgba(255,255,255,${Math.random()*.5+.3})`; ctx.beginPath(); ctx.arc((i*137)%W, (i*73)%H, Math.random()+.5, 0, Math.PI*2); ctx.fill(); }
      const gr = ctx.createRadialGradient(cx, cy, 0, cx, cy, 80);
      gr.addColorStop(0, '#e8c170'); gr.addColorStop(1, '#9b7530');
      ctx.fillStyle = gr; ctx.beginPath(); ctx.arc(cx, cy, 60, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = '#fff'; ctx.font = '14px monospace'; ctx.fillText('ğŸª V=' + state.V + 'km/s â†’', cx-50, cy+90);
      const ar = state.angle * Math.PI / 180, r = 120;
      ctx.strokeStyle = 'rgba(78,205,196,.5)'; ctx.setLineDash([5,5]); ctx.lineWidth = 2;
      ctx.beginPath(); ctx.arc(cx, cy, r, Math.PI-ar/2, Math.PI+ar/2); ctx.stroke(); ctx.setLineDash([]);
      const sx = cx + (r+10) * Math.cos(Math.PI - ar/2 + state.shipAngle);
      const sy = cy + (r+10) * Math.sin(Math.PI - ar/2 + state.shipAngle);
      ctx.fillStyle = '#4ecdc4'; ctx.beginPath(); ctx.arc(sx, sy, 8, 0, Math.PI*2); ctx.fill();
      const dv = calcDv(state.angle), v2 = state.v1 + dv;
      ctx.fillStyle = '#ffd60a'; ctx.font = '16px monospace';
      ctx.fillText('vâ‚ = ' + state.v1 + ' km/s', 20, 30);
      ctx.fillText('Î”v = 2Ã—' + state.V + 'Ã—sin(' + state.angle + 'Â°/2) = ' + dv.toFixed(1) + ' km/s', 20, 55);
      ctx.fillStyle = v2 >= state.TARGET ? '#06d6a0' : '#e63946';
      ctx.fillText('vâ‚‚ = ' + v2.toFixed(1) + ' km/s (' + t('bl2') + ': â‰¥' + state.TARGET + ')', 20, 80);
      $('currentV').textContent = v2.toFixed(1) + ' km/s';
      $('currentV').style.color = v2 >= state.TARGET ? '#06d6a0' : '#e63946';
    }
    
    function execute() {
      if (state.phase !== 'ready' || state.anim) return;
      state.attempts++; $('attemptsDisplay').textContent = state.attempts;
      state.anim = true;
      const ta = state.angle * Math.PI / 180;
      const anim = () => {
        state.shipAngle += 0.05; render();
        if (state.shipAngle < ta) requestAnimationFrame(anim);
        else { state.anim = false; showEnd(state.v1 + calcDv(state.angle) >= state.TARGET, state.v1 + calcDv(state.angle)); }
      };
      anim();
    }
    
    function showEnd(ok, v2) {
      state.score = ok ? Math.max(0, 100 - (state.attempts-1)*15) : 0;
      $('resultMedal').textContent = ok ? 'ğŸ¥‡' : 'ğŸ’”';
      $('resultTitle').textContent = ok ? t('resultSuccess') : t('resultFail');
      $('endCinematic').innerHTML = '<p>' + t('finalV') + ': ' + v2.toFixed(1) + ' km/s</p><p>Î”E = Â½m(vâ‚‚Â²-vâ‚Â²) â†’ ' + (ok ? t('endSuccess') : t('endFail')) + '</p>';
      $('nextBtn').style.display = ok ? 'block' : 'none';
      $('endModal').classList.remove('hidden');
      localStorage.setItem('atlas_game8_completed', ok);
    }
    
    function reset() { state.shipAngle = 0; state.phase = 'ready'; render(); }
    function hint() { $('dialogueText').textContent = t('dialogueHint'); state.score = Math.max(0, state.score - 5); $('scoreDisplay').textContent = state.score; }
    function startGame() { state.phase = 'ready'; $('introModal').classList.add('hidden'); }
    function goBack() { window.location.href = 'index.html'; }
    function goNext() { window.location.href = 'aerobraking.html'; }
    function retry() { $('endModal').classList.add('hidden'); state.attempts = 0; state.score = 100; $('attemptsDisplay').textContent = '0'; $('scoreDisplay').textContent = '100'; reset(); }
    
    document.addEventListener('DOMContentLoaded', () => {
      const sl = localStorage.getItem('atlas_language'); if (sl) setLanguage(sl); else updateAllText();
      resize(); window.addEventListener('resize', () => { resize(); render(); });
      $('angleSlider').addEventListener('input', e => { state.angle = parseInt(e.target.value); $('angleDisplay').textContent = state.angle + 'Â°'; render(); });
      document.addEventListener('keydown', e => { if (e.code === 'Space') execute(); if (e.code === 'KeyR') reset(); });
      render();
    });
  </script>
</body>
</html>
