<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ”´ MARS CARGO DROP â€” Mission ATLAS Act 3</title>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --void-black: #030308;
      --mars-sky: #1a0a0a;
      --mars-red: #c44536;
      --mars-dark: #6b1d1d;
      --mars-light: #e87461;
      --star-white: #f0f4ff;
      --ice-blue: #a8dadc;
      --thrust-orange: #ff6b35;
      --warning-red: #e63946;
      --success-green: #06d6a0;
      --gold: #ffd60a;
      --silver: #c0c0c0;
      --bronze: #cd7f32;
      --moon-gray: #888899;
      --font-display: 'Courier New', monospace;
      --font-body: 'Segoe UI', system-ui, sans-serif;
      --space-xs: 0.25rem;
      --space-sm: 0.5rem;
      --space-md: 1rem;
      --space-lg: 2rem;
      --space-xl: 3rem;
      --glow-red: 0 0 20px rgba(230, 57, 70, 0.5);
      --glow-gold: 0 0 20px rgba(255, 214, 10, 0.5), 0 0 40px rgba(255, 214, 10, 0.3);
      --glow-ice: 0 0 20px rgba(168, 218, 220, 0.5);
    }

    html, body { height: 100%; overflow: hidden; }

    body {
      font-family: var(--font-body);
      background: var(--void-black);
      color: var(--star-white);
    }

    .game-container {
      display: grid;
      grid-template-columns: 1fr 350px;
      grid-template-rows: auto 1fr auto;
      height: 100vh;
    }

    @media (max-width: 900px) {
      .game-container { grid-template-columns: 1fr; grid-template-rows: auto 1fr auto auto; }
    }

    .header {
      grid-column: 1 / -1;
      background: linear-gradient(180deg, rgba(26, 10, 10, 0.95), rgba(26, 10, 10, 0.8));
      padding: var(--space-sm) var(--space-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 100;
    }

    .header-left { display: flex; align-items: center; gap: var(--space-md); }

    .back-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: var(--space-sm) var(--space-md);
      color: var(--star-white);
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.3s ease;
    }

    .back-btn:hover { background: rgba(255, 255, 255, 0.2); }

    .game-title { font-family: var(--font-display); font-size: 1.2rem; letter-spacing: 0.1em; }
    .game-title .act { color: var(--gold); font-size: 0.8rem; }

    .header-center { display: flex; gap: var(--space-lg); }
    .stat-box { text-align: center; }
    .stat-value { font-family: var(--font-display); font-size: 1.3rem; font-weight: bold; }
    .stat-value.attempts { color: var(--mars-red); }
    .stat-value.score { color: var(--gold); }
    .stat-value.hints { color: var(--thrust-orange); }
    .stat-label { font-size: 0.7rem; color: var(--moon-gray); text-transform: uppercase; letter-spacing: 0.1em; }

    .header-right { display: flex; gap: var(--space-sm); }

    .lang-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 6px;
      padding: var(--space-xs) var(--space-sm);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .lang-btn:hover, .lang-btn.active {
      background: rgba(255, 214, 10, 0.2);
      border-color: var(--gold);
    }

    .canvas-wrapper { position: relative; background: var(--mars-sky); overflow: hidden; }
    #gameCanvas { display: block; width: 100%; height: 100%; }

    .control-panel {
      background: linear-gradient(180deg, rgba(40, 20, 20, 0.98), rgba(20, 10, 10, 0.98));
      padding: var(--space-md);
      overflow-y: auto;
      border-left: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    @media (max-width: 900px) {
      .control-panel { border-left: none; border-top: 1px solid rgba(255, 255, 255, 0.1); max-height: 40vh; }
    }

    .panel-section {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      padding: var(--space-md);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .section-title {
      font-family: var(--font-display);
      font-size: 0.85rem;
      color: var(--gold);
      margin-bottom: var(--space-sm);
      display: flex;
      align-items: center;
      gap: var(--space-sm);
    }

    .data-row { display: flex; justify-content: space-between; align-items: center; padding: var(--space-xs) 0; font-size: 0.85rem; }
    .data-label { color: var(--moon-gray); }
    .data-value { font-family: var(--font-display); color: var(--star-white); }
    .data-value.warning { color: var(--warning-red); animation: pulse 1s ease-in-out infinite; }
    .data-value.success { color: var(--success-green); }
    .data-value.mars { color: var(--mars-light); }

    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.6; } }

    .slider-group { margin-bottom: var(--space-md); }
    .slider-header { display: flex; justify-content: space-between; margin-bottom: var(--space-xs); }
    .slider-label { font-size: 0.85rem; color: var(--moon-gray); }
    .slider-value { font-family: var(--font-display); font-size: 0.9rem; color: var(--mars-light); }

    .slider {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      appearance: none;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      outline: none;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: linear-gradient(135deg, #c44536 0%, #e63946 100%);
      cursor: pointer;
      box-shadow: var(--glow-red);
    }

    .formula-box {
      background: rgba(196, 69, 54, 0.1);
      border: 1px solid rgba(196, 69, 54, 0.3);
      border-radius: 8px;
      padding: var(--space-sm);
      margin-bottom: var(--space-sm);
    }

    .formula { font-family: var(--font-display); font-size: 0.9rem; color: var(--mars-light); text-align: center; }
    .formula-note { font-size: 0.75rem; color: var(--moon-gray); text-align: center; margin-top: var(--space-xs); }

    .btn-group { display: flex; flex-direction: column; gap: var(--space-sm); }

    .btn {
      padding: var(--space-md);
      border: none;
      border-radius: 10px;
      font-family: var(--font-display);
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .btn-primary { background: linear-gradient(135deg, #c44536 0%, #e63946 100%); color: white; }
    .btn-primary:hover:not(:disabled) { transform: scale(1.02); box-shadow: var(--glow-red); }
    .btn-primary:disabled { background: rgba(255, 255, 255, 0.1); color: var(--moon-gray); cursor: not-allowed; }
    .btn-secondary { background: rgba(255, 255, 255, 0.1); color: var(--star-white); border: 1px solid rgba(255, 255, 255, 0.2); }
    .btn-secondary:hover { background: rgba(255, 255, 255, 0.2); }
    .btn-hint { background: rgba(255, 214, 10, 0.2); color: var(--gold); border: 1px solid rgba(255, 214, 10, 0.3); }

    .dialogue-box {
      background: rgba(0, 0, 0, 0.5);
      border-left: 3px solid var(--mars-red);
      padding: var(--space-sm);
      font-size: 0.85rem;
      line-height: 1.5;
      min-height: 60px;
    }

    .dialogue-speaker { color: var(--mars-red); font-weight: bold; font-size: 0.75rem; margin-bottom: var(--space-xs); }
    .dialogue-text { color: var(--star-white); }
    .dialogue-text .highlight { color: var(--gold); }
    .dialogue-text .ice { color: var(--ice-blue); }

    .footer {
      grid-column: 1 / -1;
      background: rgba(26, 10, 10, 0.95);
      padding: var(--space-sm) var(--space-md);
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.8rem;
      color: var(--moon-gray);
    }

    .controls-hint { display: flex; gap: var(--space-md); }
    .key { background: rgba(255, 255, 255, 0.1); padding: 2px 8px; border-radius: 4px; font-family: var(--font-display); font-size: 0.75rem; }

    /* Modals */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-lg);
      opacity: 1;
      transition: opacity 0.5s ease;
    }

    .modal-overlay.hidden { opacity: 0; pointer-events: none; }

    .modal {
      max-width: 700px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      background: linear-gradient(135deg, rgba(26, 10, 10, 0.98), rgba(46, 20, 20, 0.98));
      border: 2px solid var(--gold);
      border-radius: 20px;
      padding: var(--space-xl);
      animation: modalAppear 0.5s ease;
    }

    @keyframes modalAppear { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .modal-title {
      font-family: var(--font-display);
      font-size: 1.8rem;
      text-align: center;
      margin-bottom: var(--space-md);
      background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .lang-selector-intro {
      display: flex;
      justify-content: center;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
      padding: var(--space-md);
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
    }

    .lang-selector-intro .lang-option {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-md);
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      min-width: 100px;
    }

    .lang-selector-intro .lang-option:hover {
      background: rgba(255, 214, 10, 0.1);
      border-color: rgba(255, 214, 10, 0.5);
      transform: translateY(-3px);
    }

    .lang-selector-intro .lang-option.active {
      background: rgba(255, 214, 10, 0.2);
      border-color: var(--gold);
      box-shadow: var(--glow-gold);
    }

    .lang-selector-intro .lang-flag { font-size: 2.5rem; }
    .lang-selector-intro .lang-name { font-size: 0.85rem; color: var(--moon-gray); font-weight: bold; }
    .lang-selector-intro .lang-option.active .lang-name { color: var(--gold); }

    .lang-label {
      text-align: center;
      font-size: 0.9rem;
      color: var(--moon-gray);
      margin-bottom: var(--space-sm);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .cinematic-scene {
      background: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      padding: var(--space-lg);
      margin-bottom: var(--space-lg);
      font-family: var(--font-display);
      font-size: 0.9rem;
      line-height: 1.8;
    }

    .scene-direction { color: var(--moon-gray); font-style: italic; margin-bottom: var(--space-sm); }
    .scene-dialogue { margin-bottom: var(--space-md); }
    .scene-speaker { color: var(--mars-red); font-weight: bold; }
    .scene-speaker.vega { color: #e63946; }
    .scene-speaker.newton { color: #a8dadc; }
    .scene-speaker.patel { color: #06d6a0; }
    .scene-speaker.player { color: var(--gold); }
    .scene-text { color: var(--star-white); margin-left: var(--space-md); }
    .scene-text .emphasis { color: var(--gold); font-weight: bold; }
    .scene-text .ice { color: var(--ice-blue); }

    .briefing-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
    }

    @media (max-width: 500px) {
      .briefing-grid { grid-template-columns: 1fr; }
      .lang-selector-intro { flex-wrap: wrap; }
      .lang-selector-intro .lang-option { min-width: 80px; padding: var(--space-sm); }
      .lang-selector-intro .lang-flag { font-size: 2rem; }
    }

    .briefing-item {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 10px;
      padding: var(--space-md);
      text-align: center;
    }

    .briefing-icon { font-size: 2rem; margin-bottom: var(--space-sm); }
    .briefing-label { font-size: 0.75rem; color: var(--moon-gray); margin-bottom: var(--space-xs); }
    .briefing-value { font-family: var(--font-display); font-size: 1.1rem; color: var(--mars-light); }

    .result-display { text-align: center; margin-bottom: var(--space-lg); }
    .result-medal { font-size: 5rem; margin-bottom: var(--space-md); animation: medalBounce 0.5s ease; }
    @keyframes medalBounce { 0% { transform: scale(0); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }

    .result-title { font-family: var(--font-display); font-size: 1.5rem; margin-bottom: var(--space-sm); }
    .result-title.gold { color: var(--gold); }
    .result-title.silver { color: var(--silver); }
    .result-title.bronze { color: var(--bronze); }
    .result-title.fail { color: var(--warning-red); }

    .result-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--space-md); margin-bottom: var(--space-lg); }
    .result-stat { background: rgba(0, 0, 0, 0.3); border-radius: 10px; padding: var(--space-md); }
    .result-stat-value { font-family: var(--font-display); font-size: 1.5rem; color: var(--gold); }
    .result-stat-label { font-size: 0.75rem; color: var(--moon-gray); }

    .analysis-section {
      background: rgba(196, 69, 54, 0.1);
      border: 1px solid rgba(196, 69, 54, 0.3);
      border-radius: 12px;
      padding: var(--space-md);
      margin-bottom: var(--space-lg);
    }

    .analysis-title { font-size: 0.9rem; color: var(--mars-light); margin-bottom: var(--space-sm); }
    .analysis-row { display: flex; justify-content: space-between; padding: var(--space-xs) 0; font-size: 0.85rem; }
    .analysis-label { color: var(--moon-gray); }
    .analysis-value { font-family: var(--font-display); }
    .analysis-value.theoretical { color: var(--mars-light); }
    .analysis-value.actual { color: var(--ice-blue); }
    .analysis-value.error { color: var(--warning-red); }
    .analysis-value.good { color: var(--success-green); }

    .modal-btn {
      display: block;
      width: 100%;
      padding: var(--space-md);
      background: linear-gradient(135deg, #ffd700 0%, #ffaa00 100%);
      border: none;
      border-radius: 12px;
      font-family: var(--font-display);
      font-size: 1.1rem;
      color: var(--void-black);
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .modal-btn:hover { transform: scale(1.02); box-shadow: 0 0 30px rgba(255, 214, 10, 0.5); }
    .modal-btn.secondary { background: rgba(255, 255, 255, 0.1); color: var(--star-white); margin-top: var(--space-sm); }
    .modal-btn.victory { background: linear-gradient(135deg, #06d6a0 0%, #00a878 100%); }

    .pause-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }

    .pause-overlay.active { opacity: 1; pointer-events: all; }
    .pause-content { text-align: center; padding: var(--space-xl); }
    .pause-title { font-family: var(--font-display); font-size: 2rem; color: var(--gold); margin-bottom: var(--space-md); }
    .pause-subtitle { color: var(--star-white); margin-bottom: var(--space-lg); }
    .pause-data { background: rgba(0, 0, 0, 0.5); border-radius: 12px; padding: var(--space-lg); margin-bottom: var(--space-lg); display: inline-block; }

    .hidden { display: none !important; }
  </style>
</head>
<body>
  <!-- INTRO MODAL -->
  <div class="modal-overlay" id="introModal">
    <div class="modal">
      <h1 class="modal-title">ğŸ”´ <span id="introTitle">Î¡Î™Î¨Î— Î•Î¦ÎŸÎ”Î™Î©Î Î‘Î¡Î—Î£</span></h1>
      
      <div class="lang-label" id="langLabel">Î•Î Î™Î›Î•ÎÎ¤Î• Î“Î›Î©Î£Î£Î‘ / SELECT LANGUAGE / SELEZIONA LINGUA</div>
      <div class="lang-selector-intro">
        <div class="lang-option" data-lang="el" onclick="setLanguage('el')">
          <span class="lang-flag">ğŸ‡¬ğŸ‡·</span>
          <span class="lang-name">Î•Î»Î»Î·Î½Î¹ÎºÎ¬</span>
        </div>
        <div class="lang-option active" data-lang="en" onclick="setLanguage('en')">
          <span class="lang-flag">ğŸ‡¬ğŸ‡§</span>
          <span class="lang-name">English</span>
        </div>
        <div class="lang-option" data-lang="it" onclick="setLanguage('it')">
          <span class="lang-flag">ğŸ‡®ğŸ‡¹</span>
          <span class="lang-name">Italiano</span>
        </div>
      </div>
      
      <div class="cinematic-scene" id="cinematicScene"></div>
      
      <div class="briefing-grid">
        <div class="briefing-item">
          <div class="briefing-icon">ğŸ”´</div>
          <div class="briefing-label" id="briefingLabel1">Î’Î±ÏÏÏ„Î·Ï„Î± Î†ÏÎ·</div>
          <div class="briefing-value">g = 3.71 m/sÂ²</div>
        </div>
        <div class="briefing-item">
          <div class="briefing-icon">â¬‡ï¸</div>
          <div class="briefing-label" id="briefingLabel2">ÎÏˆÎ¿Ï‚ Î“ÎºÏÎµÎ¼Î¿Ï</div>
          <div class="briefing-value">h = 200 m</div>
        </div>
        <div class="briefing-item">
          <div class="briefing-icon">â¡ï¸</div>
          <div class="briefing-label" id="briefingLabel3">Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ· Î£Ï€Î·Î»Î¹Î¬Ï‚</div>
          <div class="briefing-value">d = 350 m</div>
        </div>
        <div class="briefing-item">
          <div class="briefing-icon">ğŸ¯</div>
          <div class="briefing-label" id="briefingLabel4">Î£Ï„ÏŒÏ‡Î¿Ï‚ Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±Ï‚</div>
          <div class="briefing-value">Â±10 m</div>
        </div>
      </div>
      
      <button class="modal-btn" id="startGameBtn">
        ğŸ”´ <span id="startBtnText">Î•ÎÎ‘Î¡ÎÎ— Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î—Î£</span>
      </button>
    </div>
  </div>

  <!-- PAUSE OVERLAY -->
  <div class="pause-overlay" id="pauseOverlay">
    <div class="pause-content">
      <h2 class="pause-title">â¸ï¸ <span id="pauseTitle">Î Î‘Î¥Î£Î—</span></h2>
      <p class="pause-subtitle" id="pauseSubtitle">Î¥Ï€Î¿Î»ÏŒÎ³Î¹ÏƒÎµ Ï„Î·Î½ Î¿ÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± Î²Î¿Î»Î®!</p>
      <div class="pause-data">
        <div class="formula-box">
          <div class="formula">x = vâ‚€ Â· t</div>
          <div class="formula-note" id="formulaP1">ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± ÎºÎ¯Î½Î·ÏƒÎ· (Î¿Î¼Î±Î»Î®)</div>
        </div>
        <div class="formula-box">
          <div class="formula">y = Â½ Â· g Â· tÂ²</div>
          <div class="formula-note" id="formulaP2">ÎšÎ±Ï„Î±ÎºÏŒÏÏ…Ï†Î· ÎºÎ¯Î½Î·ÏƒÎ· (ÎµÎ»ÎµÏÎ¸ÎµÏÎ· Ï€Ï„ÏÏƒÎ·)</div>
        </div>
        <div class="formula-box">
          <div class="formula">t = âˆš(2h/g)</div>
          <div class="formula-note" id="formulaP3">Î§ÏÏŒÎ½Î¿Ï‚ Ï€Ï„ÏÏƒÎ·Ï‚</div>
        </div>
      </div>
      <button class="btn btn-primary" onclick="togglePause()">
        â–¶ï¸ <span id="resumeBtnText">Î£Î¥ÎÎ•Î§Î•Î™Î‘</span>
      </button>
    </div>
  </div>

  <!-- END MODAL -->
  <div class="modal-overlay hidden" id="endModal">
    <div class="modal">
      <div class="result-display">
        <div class="result-medal" id="resultMedal">ğŸ¥‡</div>
        <h2 class="result-title gold" id="resultTitle">Î¤Î•Î›Î•Î™Î‘ Î¡Î™Î¨Î—!</h2>
      </div>
      <div class="cinematic-scene" id="endCinematic"></div>
      <div class="result-stats">
        <div class="result-stat">
          <div class="result-stat-value" id="finalScore">100</div>
          <div class="result-stat-label" id="scoreStatLabel">Î’Î‘Î˜ÎœÎŸÎ£</div>
        </div>
        <div class="result-stat">
          <div class="result-stat-value" id="finalAttempts">1</div>
          <div class="result-stat-label" id="attemptsStatLabel">Î Î¡ÎŸÎ£Î Î‘Î˜Î•Î™Î•Î£</div>
        </div>
        <div class="result-stat">
          <div class="result-stat-value" id="finalError">2.5</div>
          <div class="result-stat-label" id="errorStatLabel">Î‘Î ÎŸÎšÎ›Î™Î£Î— (m)</div>
        </div>
      </div>
      <div class="analysis-section">
        <div class="analysis-title" id="analysisTitle">ğŸ“Š Î‘ÎÎ‘Î›Î¥Î£Î— ÎŸÎ¡Î™Î–ÎŸÎÎ¤Î™Î‘Î£ Î’ÎŸÎ›Î—Î£</div>
        <div class="analysis-row">
          <span class="analysis-label" id="flightTimeLabel">Î§ÏÏŒÎ½Î¿Ï‚ Ï€Ï„ÏÏƒÎ·Ï‚:</span>
          <span class="analysis-value theoretical" id="flightTimeValue">--</span>
        </div>
        <div class="analysis-row">
          <span class="analysis-label" id="theoreticalLabel">Î˜ÎµÏ‰ÏÎ·Ï„Î¹ÎºÏŒ vâ‚€:</span>
          <span class="analysis-value theoretical" id="theoreticalV">--</span>
        </div>
        <div class="analysis-row">
          <span class="analysis-label" id="actualLabel">Î•Ï†Î±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î¿ vâ‚€:</span>
          <span class="analysis-value actual" id="actualV">--</span>
        </div>
        <div class="analysis-row">
          <span class="analysis-label" id="landingLabel">Î£Î·Î¼ÎµÎ¯Î¿ Ï€ÏÏŒÏƒÎºÏÎ¿Ï…ÏƒÎ·Ï‚:</span>
          <span class="analysis-value" id="landingValue">--</span>
        </div>
      </div>
      <button class="modal-btn victory" id="victoryBtn">
        ğŸ† <span id="victoryBtnText">Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î— ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î˜Î—ÎšÎ•!</span>
      </button>
      <button class="modal-btn secondary" id="retryBtn">
        â†º <span id="retryBtnText">Î”ÎŸÎšÎ™ÎœÎ‘Î£Î• ÎÎ‘ÎÎ‘</span>
      </button>
    </div>
  </div>

  <!-- MAIN GAME -->
  <div class="game-container">
    <header class="header">
      <div class="header-left">
        <button class="back-btn" onclick="goBack()">â† <span id="backText">Î Î™Î£Î©</span></button>
        <div class="game-title">
          <div class="act">ACT 3</div>
          <span id="headerTitle">MARS CARGO DROP</span>
        </div>
      </div>
      <div class="header-center">
        <div class="stat-box">
          <div class="stat-value attempts" id="attemptsDisplay">0</div>
          <div class="stat-label" id="attemptsLabel">Î Î¡ÎŸÎ£Î Î‘Î˜Î•Î™Î•Î£</div>
        </div>
        <div class="stat-box">
          <div class="stat-value score" id="scoreDisplay">100</div>
          <div class="stat-label" id="scoreLabelHeader">Î’Î‘Î˜ÎœÎŸÎ£</div>
        </div>
        <div class="stat-box">
          <div class="stat-value hints" id="hintsDisplay">0</div>
          <div class="stat-label" id="hintsLabel">HINTS</div>
        </div>
      </div>
      <div class="header-right">
        <button class="lang-btn" data-lang="el" onclick="setLanguage('el')">ğŸ‡¬ğŸ‡·</button>
        <button class="lang-btn active" data-lang="en" onclick="setLanguage('en')">ğŸ‡¬ğŸ‡§</button>
        <button class="lang-btn" data-lang="it" onclick="setLanguage('it')">ğŸ‡®ğŸ‡¹</button>
        <button class="lang-btn" data-lang="es" onclick="setLanguage('es')">ğŸ‡ªğŸ‡¸</button>
        <button class="lang-btn" data-lang="bg" onclick="setLanguage('bg')">ğŸ‡§ğŸ‡¬</button>
        <button class="lang-btn" data-lang="pt" onclick="setLanguage('pt')">ğŸ‡µğŸ‡¹</button>
        <button class="lang-btn" data-lang="de" onclick="setLanguage('de')">ğŸ‡©ğŸ‡ª</button>
        <button class="lang-btn" data-lang="fr" onclick="setLanguage('fr')">ğŸ‡«ğŸ‡·</button>
        <button class="lang-btn" data-lang="fi" onclick="setLanguage('fi')">ğŸ‡«ğŸ‡®</button>
      </div>
    </header>

    <div class="canvas-wrapper">
      <canvas id="gameCanvas"></canvas>
    </div>

    <div class="control-panel">
      <div class="panel-section">
        <div class="section-title"><span>ğŸ“¡</span><span id="missionDataTitle">Î”Î•Î”ÎŸÎœÎ•ÎÎ‘ Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î—Î£</span></div>
        <div class="data-row">
          <span class="data-label" id="cliffLabel">ÎÏˆÎ¿Ï‚ Î³ÎºÏÎµÎ¼Î¿Ï:</span>
          <span class="data-value mars" id="cliffValue">200 m</span>
        </div>
        <div class="data-row">
          <span class="data-label" id="targetDistLabel">Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ· ÏƒÏ€Î·Î»Î¹Î¬Ï‚:</span>
          <span class="data-value" id="targetDistValue">350 m</span>
        </div>
        <div class="data-row">
          <span class="data-label" id="gravityLabel">Î’Î±ÏÏÏ„Î·Ï„Î± Î†ÏÎ·:</span>
          <span class="data-value mars" id="gravityValue">3.71 m/sÂ²</span>
        </div>
        <div class="data-row">
          <span class="data-label" id="flightLabel">Î§ÏÏŒÎ½Î¿Ï‚ Ï€Ï„Î®ÏƒÎ·Ï‚:</span>
          <span class="data-value" id="flightValue">-- s</span>
        </div>
      </div>

      <div class="panel-section">
        <div class="section-title"><span>ğŸš€</span><span id="launchTitle">Î•Î›Î•Î“Î§ÎŸÎ£ Î•ÎšÎ¤ÎŸÎÎ•Î¥Î£Î—Î£</span></div>
        <div class="slider-group">
          <div class="slider-header">
            <span class="slider-label" id="velocityLabel">Î‘ÏÏ‡Î¹ÎºÎ® Î¤Î±Ï‡ÏÏ„Î·Ï„Î± (vâ‚€):</span>
            <span class="slider-value" id="velocityDisplay">0 m/s</span>
          </div>
          <input type="range" class="slider" id="velocitySlider" min="0" max="100" value="0" step="1">
        </div>
        <p style="font-size: 0.75rem; color: var(--moon-gray); text-align: center;" id="velocityHint">
          ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± Ï„Î±Ï‡ÏÏ„Î·Ï„Î± ÎµÎºÏ„ÏŒÎ¾ÎµÏ…ÏƒÎ·Ï‚ Ï„Î¿Ï… Ï†Î¿ÏÏ„Î¯Î¿Ï…
        </p>
      </div>

      <div class="panel-section">
        <div class="section-title"><span>ğŸ“</span><span id="physicsTitle">ÎŸÎ¡Î™Î–ÎŸÎÎ¤Î™Î‘ Î’ÎŸÎ›Î—</span></div>
        <div class="formula-box">
          <div class="formula">x = vâ‚€ Â· t</div>
          <div class="formula-note" id="formulaNote1">ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î±: Î¿Î¼Î±Î»Î® ÎºÎ¯Î½Î·ÏƒÎ·</div>
        </div>
        <div class="formula-box">
          <div class="formula">y = Â½ Â· g Â· tÂ²</div>
          <div class="formula-note" id="formulaNote2">ÎšÎ±Ï„Î±ÎºÏŒÏÏ…Ï†Î·: ÎµÎ»ÎµÏÎ¸ÎµÏÎ· Ï€Ï„ÏÏƒÎ·</div>
        </div>
        <div class="formula-box">
          <div class="formula">t = âˆš(2h/g) â‰ˆ 10.4 s</div>
          <div class="formula-note" id="formulaNote3">Î§ÏÏŒÎ½Î¿Ï‚ Î³Î¹Î± h=200m, g=3.71</div>
        </div>
      </div>

      <div class="panel-section">
        <div class="btn-group">
          <button class="btn btn-primary" id="launchBtn">
            ğŸš€ <span id="launchBtnText">Î•ÎšÎ¤ÎŸÎÎ•Î¥Î£Î— Î¦ÎŸÎ¡Î¤Î™ÎŸÎ¥</span>
          </button>
          <button class="btn btn-secondary" id="resetBtn" disabled>
            â†º <span id="resetBtnText">Î•Î Î‘ÎÎ‘Î¦ÎŸÎ¡Î‘</span>
          </button>
          <button class="btn btn-hint" id="hintBtn">
            ğŸ’¡ <span id="hintBtnText">Î¥Î ÎŸÎ”Î•Î™ÎÎ— (-5)</span>
          </button>
        </div>
      </div>

      <div class="panel-section">
        <div class="dialogue-box">
          <div class="dialogue-speaker" id="dialogueSpeaker">NEWTON:</div>
          <div class="dialogue-text" id="dialogueText">
            ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± Î²Î¿Î»Î®: Î· Î¿ÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± ÎºÎ¯Î½Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ <span class="highlight">Î±Î½ÎµÎ¾Î¬ÏÏ„Î·Ï„Î·</span> Î±Ï€ÏŒ Ï„Î·Î½ ÎºÎ±Ï„Î±ÎºÏŒÏÏ…Ï†Î·!
          </div>
        </div>
      </div>
    </div>

    <footer class="footer">
      <div class="controls-hint">
        <span><span class="key">SPACE</span> <span id="keyLaunch">Î•ÎºÏ„ÏŒÎ¾ÎµÏ…ÏƒÎ·</span></span>
        <span><span class="key">P</span> <span id="keyPause">Î Î±ÏÏƒÎ·</span></span>
        <span><span class="key">R</span> <span id="keyReset">Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬</span></span>
        <span><span class="key">H</span> <span id="keyHint">Î¥Ï€ÏŒÎ´ÎµÎ¹Î¾Î·</span></span>
      </div>
      <div id="footerInfo">Î†ÏÎ·Ï‚ â€” Valles Marineris | g = 3.71 m/sÂ²</div>
    </footer>
  </div>

  <script>
    /* ===== I18N ===== */
    const I18N = {
      el: {
        langLabel: "Î•Î Î™Î›Î•ÎÎ¤Î• Î“Î›Î©Î£Î£Î‘",
        introTitle: "Î¡Î™Î¨Î— Î•Î¦ÎŸÎ”Î™Î©Î Î‘Î¡Î—Î£",
        headerTitle: "MARS CARGO DROP",
        startBtnText: "Î•ÎÎ‘Î¡ÎÎ— Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î—Î£",
        backText: "Î Î™Î£Î©",
        attemptsLabel: "Î Î¡ÎŸÎ£Î Î‘Î˜Î•Î™Î•Î£",
        scoreLabelHeader: "Î’Î‘Î˜ÎœÎŸÎ£",
        hintsLabel: "HINTS",
        missionDataTitle: "Î”Î•Î”ÎŸÎœÎ•ÎÎ‘ Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î—Î£",
        cliffLabel: "ÎÏˆÎ¿Ï‚ Î³ÎºÏÎµÎ¼Î¿Ï:",
        targetDistLabel: "Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ· ÏƒÏ€Î·Î»Î¹Î¬Ï‚:",
        gravityLabel: "Î’Î±ÏÏÏ„Î·Ï„Î± Î†ÏÎ·:",
        flightLabel: "Î§ÏÏŒÎ½Î¿Ï‚ Ï€Ï„Î®ÏƒÎ·Ï‚:",
        launchTitle: "Î•Î›Î•Î“Î§ÎŸÎ£ Î•ÎšÎ¤ÎŸÎÎ•Î¥Î£Î—Î£",
        velocityLabel: "Î‘ÏÏ‡Î¹ÎºÎ® Î¤Î±Ï‡ÏÏ„Î·Ï„Î± (vâ‚€):",
        velocityHint: "ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± Ï„Î±Ï‡ÏÏ„Î·Ï„Î± ÎµÎºÏ„ÏŒÎ¾ÎµÏ…ÏƒÎ·Ï‚ Ï„Î¿Ï… Ï†Î¿ÏÏ„Î¯Î¿Ï…",
        physicsTitle: "ÎŸÎ¡Î™Î–ÎŸÎÎ¤Î™Î‘ Î’ÎŸÎ›Î—",
        formulaNote1: "ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î±: Î¿Î¼Î±Î»Î® ÎºÎ¯Î½Î·ÏƒÎ·",
        formulaNote2: "ÎšÎ±Ï„Î±ÎºÏŒÏÏ…Ï†Î·: ÎµÎ»ÎµÏÎ¸ÎµÏÎ· Ï€Ï„ÏÏƒÎ·",
        formulaNote3: "Î§ÏÏŒÎ½Î¿Ï‚ Î³Î¹Î± h=200m, g=3.71",
        launchBtnText: "Î•ÎšÎ¤ÎŸÎÎ•Î¥Î£Î— Î¦ÎŸÎ¡Î¤Î™ÎŸÎ¥",
        resetBtnText: "Î•Î Î‘ÎÎ‘Î¦ÎŸÎ¡Î‘",
        hintBtnText: "Î¥Î ÎŸÎ”Î•Î™ÎÎ— (-5)",
        keyLaunch: "Î•ÎºÏ„ÏŒÎ¾ÎµÏ…ÏƒÎ·",
        keyPause: "Î Î±ÏÏƒÎ·",
        keyReset: "Î•Ï€Î±Î½Î±Ï†Î¿ÏÎ¬",
        keyHint: "Î¥Ï€ÏŒÎ´ÎµÎ¹Î¾Î·",
        pauseTitle: "Î Î‘Î¥Î£Î—",
        pauseSubtitle: "Î¥Ï€Î¿Î»ÏŒÎ³Î¹ÏƒÎµ Ï„Î·Î½ Î¿ÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± Î²Î¿Î»Î®!",
        formulaP1: "ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± ÎºÎ¯Î½Î·ÏƒÎ· (Î¿Î¼Î±Î»Î®)",
        formulaP2: "ÎšÎ±Ï„Î±ÎºÏŒÏÏ…Ï†Î· ÎºÎ¯Î½Î·ÏƒÎ· (ÎµÎ»ÎµÏÎ¸ÎµÏÎ· Ï€Ï„ÏÏƒÎ·)",
        formulaP3: "Î§ÏÏŒÎ½Î¿Ï‚ Ï€Ï„ÏÏƒÎ·Ï‚",
        resumeBtnText: "Î£Î¥ÎÎ•Î§Î•Î™Î‘",
        scoreStatLabel: "Î’Î‘Î˜ÎœÎŸÎ£",
        attemptsStatLabel: "Î Î¡ÎŸÎ£Î Î‘Î˜Î•Î™Î•Î£",
        errorStatLabel: "Î‘Î ÎŸÎšÎ›Î™Î£Î— (m)",
        analysisTitle: "ğŸ“Š Î‘ÎÎ‘Î›Î¥Î£Î— ÎŸÎ¡Î™Î–ÎŸÎÎ¤Î™Î‘Î£ Î’ÎŸÎ›Î—Î£",
        flightTimeLabel: "Î§ÏÏŒÎ½Î¿Ï‚ Ï€Ï„ÏÏƒÎ·Ï‚:",
        theoreticalLabel: "Î˜ÎµÏ‰ÏÎ·Ï„Î¹ÎºÏŒ vâ‚€:",
        actualLabel: "Î•Ï†Î±ÏÎ¼Î¿ÏƒÎ¼Î­Î½Î¿ vâ‚€:",
        landingLabel: "Î£Î·Î¼ÎµÎ¯Î¿ Ï€ÏÏŒÏƒÎºÏÎ¿Ï…ÏƒÎ·Ï‚:",
        victoryBtnText: "Î‘Î ÎŸÎ£Î¤ÎŸÎ›Î— ÎŸÎ›ÎŸÎšÎ›Î—Î¡Î©Î˜Î—ÎšÎ•!",
        retryBtnText: "Î”ÎŸÎšÎ™ÎœÎ‘Î£Î• ÎÎ‘ÎÎ‘",
        briefingLabel1: "Î’Î±ÏÏÏ„Î·Ï„Î± Î†ÏÎ·",
        briefingLabel2: "ÎÏˆÎ¿Ï‚ Î“ÎºÏÎµÎ¼Î¿Ï",
        briefingLabel3: "Î‘Ï€ÏŒÏƒÏ„Î±ÏƒÎ· Î£Ï€Î·Î»Î¹Î¬Ï‚",
        briefingLabel4: "Î£Ï„ÏŒÏ‡Î¿Ï‚ Î‘ÎºÏÎ¯Î²ÎµÎ¹Î±Ï‚",
        footerInfo: "Î†ÏÎ·Ï‚ â€” Valles Marineris | g = 3.71 m/sÂ²",
        cinematicScene: `
          <div class="scene-direction">[Î†ÏÎ·Ï‚ â€” 6 Î¼Î®Î½ÎµÏ‚ Î¼ÎµÏ„Î¬ Ï„Î·Î½ Î±Î½Î±Ï‡ÏÏÎ·ÏƒÎ· Î±Ï€ÏŒ Ï„Î· Î“Î·]</div>
          <div class="scene-dialogue">
            <span class="scene-speaker vega">COMMANDER VEGA:</span>
            <span class="scene-text">"Î’ÏÎ®ÎºÎ±Î¼Îµ Î¼Î¹Î± <span class="ice">ÏƒÏ€Î·Î»Î¹Î¬ Ï€Î¬Î³Î¿Ï…</span> â€” Ï„Î­Î»ÎµÎ¹Î¿ ÎºÎ±Ï„Î±Ï†ÏÎ³Î¹Î¿ Î³Î¹Î± Ï„Î· Î²Î¬ÏƒÎ·. Î‘Î»Î»Î¬ ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î· Î²Î¬ÏƒÎ· ÎµÎ½ÏŒÏ‚ Î³ÎºÏÎµÎ¼Î¿Ï <span class="emphasis">200 Î¼Î­Ï„ÏÏ‰Î½</span>."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker newton">NEWTON:</span>
            <span class="scene-text">"Î— ÏƒÏ€Î·Î»Î¹Î¬ Î²ÏÎ¯ÏƒÎºÎµÏ„Î±Î¹ <span class="emphasis">350 Î¼Î­Ï„ÏÎ±</span> Î¿ÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± Î±Ï€ÏŒ Ï„Î·Î½ Î¬ÎºÏÎ·. Î ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎºÏ„Î¿Î¾ÎµÏÏƒÎµÎ¹Ï‚ Ï„Î± ÎµÏ†ÏŒÎ´Î¹Î± Î¼Îµ Ï„Î·Î½ ÎºÎ±Ï„Î¬Î»Î»Î·Î»Î· Ï„Î±Ï‡ÏÏ„Î·Ï„Î±."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker patel">DR. PATEL:</span>
            <span class="scene-text">"ÎˆÏ‡Î¿Ï…Î¼Îµ ÎµÏ†ÏŒÎ´Î¹Î± Î³Î¹Î± <span class="emphasis">Î¼Î¯Î± Ï€ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î±</span>. Î‘Î½ Ï‡Î¬ÏƒÎµÎ¹Ï‚, Ï„Î± Ï‡Î¬Î½Î¿Ï…Î¼Îµ Î³Î¹Î± Ï€Î¬Î½Ï„Î±."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker player">Î•Î£Î¥:</span>
            <span class="scene-text">"x = vâ‚€Â·t, y = Â½gtÂ²... ÎœÎµ g = 3.71 m/sÂ² ÏƒÏ„Î¿Î½ Î†ÏÎ·, Î¿ Ï‡ÏÏŒÎ½Î¿Ï‚ Ï€Ï„ÏÏƒÎ·Ï‚ ÎµÎ¯Î½Î±Î¹..."</span>
          </div>
        `,
        dialogueReady: "ÎŸÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± Î²Î¿Î»Î®: Î· Î¿ÏÎ¹Î¶ÏŒÎ½Ï„Î¹Î± ÎºÎ¯Î½Î·ÏƒÎ· ÎµÎ¯Î½Î±Î¹ <span class='highlight'>Î±Î½ÎµÎ¾Î¬ÏÏ„Î·Ï„Î·</span> Î±Ï€ÏŒ Ï„Î·Î½ ÎºÎ±Ï„Î±ÎºÏŒÏÏ…Ï†Î·!",
        dialogueFlying: "Î¤Î¿ Ï†Î¿ÏÏ„Î¯Î¿ Ï€ÎµÏ„Î¬ÎµÎ¹! Î— Ï€Î±ÏÎ±Î²Î¿Î»Î¹ÎºÎ® Ï„ÏÎ¿Ï‡Î¹Î¬ ÎµÎ¯Î½Î±Î¹ Î¿Î¼Î¿ÏÏ†Î·...",
        dialogueSuccess: "Î¤Î­Î»ÎµÎ¹Î± ÏÎ¯ÏˆÎ·! Î¤Î± ÎµÏ†ÏŒÎ´Î¹Î± Ï€ÏÎ¿ÏƒÎ³ÎµÎ¹ÏÎ¸Î·ÎºÎ±Î½ ÏƒÏ„Î· ÏƒÏ€Î·Î»Î¹Î¬!",
        dialogueFail: "Î¤Î± ÎµÏ†ÏŒÎ´Î¹Î± Î­Ï€ÎµÏƒÎ±Î½ ÎµÎºÏ„ÏŒÏ‚ ÏƒÏ„ÏŒÏ‡Î¿Ï…! Î§Î¬Î¸Î·ÎºÎ±Î½ Î³Î¹Î± Ï€Î¬Î½Ï„Î±...",
        dialogueClose: "Î£Ï‡ÎµÎ´ÏŒÎ½! Î›Î¯Î³Î¿ Ï€Î¹Î¿ Î±ÎºÏÎ¹Î²Î®Ï‚ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï„Î·Î½ ÎµÏ€ÏŒÎ¼ÎµÎ½Î· Ï†Î¿ÏÎ¬.",
        dialogueHint: "Î’Î®Î¼Î± 1: Î’ÏÎµÏ‚ Ï„Î¿Î½ Ï‡ÏÏŒÎ½Î¿ Ï€Ï„ÏÏƒÎ·Ï‚ Î±Ï€ÏŒ t = âˆš(2h/g). Î’Î®Î¼Î± 2: Î¥Ï€Î¿Î»ÏŒÎ³Î¹ÏƒÎµ vâ‚€ = d/t. ÎˆÏ‡ÎµÎ¹Ï‚ ÏŒÎ»Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±!",
        resultGold: "Î¤Î•Î›Î•Î™Î‘ Î¡Î™Î¨Î—!",
        resultSilver: "ÎšÎ‘Î›Î— Î¡Î™Î¨Î—!",
        resultBronze: "Î•Î Î™Î¤Î¥Î§Î—Î£ Î¡Î™Î¨Î—",
        resultFail: "Î‘Î ÎŸÎ¤Î¥Î§Î™Î‘ Î¡Î™Î¨Î—Î£",
        endSuccess: `
          <div class="scene-direction">[Î£Ï€Î·Î»Î¹Î¬ Î Î¬Î³Î¿Ï… â€” Î•Ï†ÏŒÎ´Î¹Î± Ï€ÏÎ¿ÏƒÎ³ÎµÎ¹Ï‰Î¼Î­Î½Î±]</div>
          <div class="scene-dialogue">
            <span class="scene-speaker newton">NEWTON:</span>
            <span class="scene-text">"Î ÏÏŒÏƒÎºÏÎ¿Ï…ÏƒÎ· ÎµÏ€Î¹Ï„Ï…Ï‡Î®Ï‚. Î¤Î± ÎµÏ†ÏŒÎ´Î¹Î± ÎµÎ¯Î½Î±Î¹ ÏƒÏ„Î· ÏƒÏ€Î·Î»Î¹Î¬. Î‘Ï…Ï„ÏŒ Î®Ï„Î±Î½... Î±Î¾Î¹Î¿ÏƒÎ·Î¼ÎµÎ¯Ï‰Ï„Î± Î±ÎºÏÎ¹Î²Î­Ï‚."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker vega">COMMANDER VEGA:</span>
            <span class="scene-text">"Calculator... Alex... Ï‡Ï‰ÏÎ¯Ï‚ ÎµÏƒÎ­Î½Î±, Î¸Î± Î®Î¼Î±ÏƒÏ„Î±Î½ Î½ÎµÎºÏÎ¿Î¯ Ï„ÏÎµÎ¹Ï‚ Ï†Î¿ÏÎ­Ï‚. Î— Ï†Ï…ÏƒÎ¹ÎºÎ® Î¼Î±Ï‚ Î­ÏƒÏ‰ÏƒÎµ Ï„Î· Î¶Ï‰Î®."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker patel">DR. PATEL:</span>
            <span class="scene-text">"Î£Î¿Ï… Ï‡ÏÏ‰ÏƒÏ„Î¬Ï‰ Î´ÏÎ¿ Î³ÎµÏÎ¼Î±Ï„Î± Ï„ÏÏÎ±. Î˜Î± Ï„Î± Ï€Î¬ÏÎµÎ¹Ï‚ ÏŒÏ„Î±Î½ Ï†Ï„Î¹Î¬Î¾Î¿Ï…Î¼Îµ Ï„Î· Î²Î¬ÏƒÎ·."</span>
          </div>
        `,
        endFail: `
          <div class="scene-direction">[Î“ÎºÏÎµÎ¼ÏŒÏ‚ â€” Î¤Î± ÎµÏ†ÏŒÎ´Î¹Î± Ï‡Î¬Î¸Î·ÎºÎ±Î½]</div>
          <div class="scene-dialogue">
            <span class="scene-speaker newton">NEWTON:</span>
            <span class="scene-text">"Î¤Î± ÎµÏ†ÏŒÎ´Î¹Î± Î´ÎµÎ½ Î­Ï†Ï„Î±ÏƒÎ±Î½ Ï„Î¿Î½ ÏƒÏ„ÏŒÏ‡Î¿. ÎšÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·: ÎºÎ±Ï„Î±ÏƒÏ„ÏÎ¬Ï†Î·ÎºÎ±Î½."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker patel">DR. PATEL:</span>
            <span class="scene-text">"Î‘Ï…Ï„Î¬ Î®Ï„Î±Î½ Ï„Î± Î¼ÏŒÎ½Î± ÎµÏ†ÏŒÎ´Î¹Î± Î¼Î±Ï‚... Î¸Î± Ï€ÏÎ­Ï€ÎµÎ¹ Î½Î± Î²ÏÎ¿ÏÎ¼Îµ Î¬Î»Î»Î· Î»ÏÏƒÎ·."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker vega">COMMANDER VEGA:</span>
            <span class="scene-text">"Î”Î¿ÎºÎ¯Î¼Î±ÏƒÎµ Î¾Î±Î½Î¬. Î— Ï†Ï…ÏƒÎ¹ÎºÎ® ÎµÎ¯Î½Î±Î¹ Î· Î¯Î´Î¹Î±. ÎœÏŒÎ½Î¿ Î¿Î¹ Ï…Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯ Î±Î»Î»Î¬Î¶Î¿Ï…Î½."</span>
          </div>
        `
      },
      en: {
        langLabel: "SELECT LANGUAGE",
        introTitle: "MARS CARGO DROP",
        headerTitle: "MARS CARGO DROP",
        startBtnText: "START MISSION",
        backText: "BACK",
        attemptsLabel: "ATTEMPTS",
        scoreLabelHeader: "SCORE",
        hintsLabel: "HINTS",
        missionDataTitle: "MISSION DATA",
        cliffLabel: "Cliff height:",
        targetDistLabel: "Cave distance:",
        gravityLabel: "Mars gravity:",
        flightLabel: "Flight time:",
        launchTitle: "LAUNCH CONTROL",
        velocityLabel: "Initial Velocity (vâ‚€):",
        velocityHint: "Horizontal launch velocity of cargo",
        physicsTitle: "PROJECTILE MOTION",
        formulaNote1: "Horizontal: uniform motion",
        formulaNote2: "Vertical: free fall",
        formulaNote3: "Time for h=200m, g=3.71",
        launchBtnText: "LAUNCH CARGO",
        resetBtnText: "RESET",
        hintBtnText: "HINT (-5)",
        keyLaunch: "Launch",
        keyPause: "Pause",
        keyReset: "Reset",
        keyHint: "Hint",
        pauseTitle: "PAUSED",
        pauseSubtitle: "Calculate the projectile motion!",
        formulaP1: "Horizontal motion (uniform)",
        formulaP2: "Vertical motion (free fall)",
        formulaP3: "Flight time",
        resumeBtnText: "RESUME",
        scoreStatLabel: "SCORE",
        attemptsStatLabel: "ATTEMPTS",
        errorStatLabel: "DEVIATION (m)",
        analysisTitle: "ğŸ“Š PROJECTILE MOTION ANALYSIS",
        flightTimeLabel: "Flight time:",
        theoreticalLabel: "Theoretical vâ‚€:",
        actualLabel: "Applied vâ‚€:",
        landingLabel: "Landing point:",
        victoryBtnText: "MISSION COMPLETE!",
        retryBtnText: "TRY AGAIN",
        briefingLabel1: "Mars Gravity",
        briefingLabel2: "Cliff Height",
        briefingLabel3: "Cave Distance",
        briefingLabel4: "Accuracy Target",
        footerInfo: "Mars â€” Valles Marineris | g = 3.71 m/sÂ²",
        cinematicScene: `
          <div class="scene-direction">[Mars â€” 6 months after departure from Earth]</div>
          <div class="scene-dialogue">
            <span class="scene-speaker vega">COMMANDER VEGA:</span>
            <span class="scene-text">"We found an <span class="ice">ice cave</span> â€” perfect shelter for the base. But it's at the base of a <span class="emphasis">200-meter</span> cliff."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker newton">NEWTON:</span>
            <span class="scene-text">"The cave is <span class="emphasis">350 meters</span> horizontally from the edge. You need to launch the supplies with the right velocity."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker patel">DR. PATEL:</span>
            <span class="scene-text">"We have supplies for <span class="emphasis">one attempt</span>. If you miss, we lose them forever."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker player">YOU:</span>
            <span class="scene-text">"x = vâ‚€Â·t, y = Â½gtÂ²... With g = 3.71 m/sÂ² on Mars, the flight time is..."</span>
          </div>
        `,
        dialogueReady: "Projectile motion: horizontal motion is <span class='highlight'>independent</span> of vertical!",
        dialogueFlying: "Cargo flying! The parabolic trajectory is beautiful...",
        dialogueSuccess: "Perfect drop! The supplies landed in the cave!",
        dialogueFail: "Supplies missed the target! Lost forever...",
        dialogueClose: "Close! A bit more accurate calculation next time.",
        dialogueHint: "Step 1: Find flight time using t = âˆš(2h/g). Step 2: Calculate vâ‚€ = d/t. You have all the data!",
        resultGold: "PERFECT DROP!",
        resultSilver: "GOOD DROP!",
        resultBronze: "SUCCESSFUL DROP",
        resultFail: "DROP FAILED",
        endSuccess: `
          <div class="scene-direction">[Ice Cave â€” Supplies landed]</div>
          <div class="scene-dialogue">
            <span class="scene-speaker newton">NEWTON:</span>
            <span class="scene-text">"Impact successful. Supplies are in the cave. That was... remarkably accurate."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker vega">COMMANDER VEGA:</span>
            <span class="scene-text">"Calculator... Alex... without you, we'd be dead three times over. Physics saved our lives."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker patel">DR. PATEL:</span>
            <span class="scene-text">"I owe you two meals now. You'll get them when we build the base."</span>
          </div>
        `,
        endFail: `
          <div class="scene-direction">[Cliff â€” Supplies lost]</div>
          <div class="scene-dialogue">
            <span class="scene-speaker newton">NEWTON:</span>
            <span class="scene-text">"Supplies did not reach the target. Status: destroyed."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker patel">DR. PATEL:</span>
            <span class="scene-text">"Those were our only supplies... we'll have to find another solution."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker vega">COMMANDER VEGA:</span>
            <span class="scene-text">"Try again. Physics is the same. Only the calculations change."</span>
          </div>
        `
      },
      it: {
        langLabel: "SELEZIONA LINGUA",
        introTitle: "LANCIO CARGO MARTE",
        headerTitle: "MARS CARGO DROP",
        startBtnText: "INIZIA MISSIONE",
        backText: "INDIETRO",
        attemptsLabel: "TENTATIVI",
        scoreLabelHeader: "PUNTEGGIO",
        hintsLabel: "HINTS",
        missionDataTitle: "DATI MISSIONE",
        cliffLabel: "Altezza scogliera:",
        targetDistLabel: "Distanza grotta:",
        gravityLabel: "GravitÃ  Marte:",
        flightLabel: "Tempo di volo:",
        launchTitle: "CONTROLLO LANCIO",
        velocityLabel: "VelocitÃ  Iniziale (vâ‚€):",
        velocityHint: "VelocitÃ  orizzontale di lancio del cargo",
        physicsTitle: "MOTO PARABOLICO",
        formulaNote1: "Orizzontale: moto uniforme",
        formulaNote2: "Verticale: caduta libera",
        formulaNote3: "Tempo per h=200m, g=3.71",
        launchBtnText: "LANCIA CARGO",
        resetBtnText: "RESETTA",
        hintBtnText: "SUGGERIMENTO (-5)",
        keyLaunch: "Lancia",
        keyPause: "Pausa",
        keyReset: "Resetta",
        keyHint: "Sugger.",
        pauseTitle: "PAUSA",
        pauseSubtitle: "Calcola il moto parabolico!",
        formulaP1: "Moto orizzontale (uniforme)",
        formulaP2: "Moto verticale (caduta libera)",
        formulaP3: "Tempo di volo",
        resumeBtnText: "RIPRENDI",
        scoreStatLabel: "PUNTEGGIO",
        attemptsStatLabel: "TENTATIVI",
        errorStatLabel: "DEVIAZIONE (m)",
        analysisTitle: "ğŸ“Š ANALISI MOTO PARABOLICO",
        flightTimeLabel: "Tempo di volo:",
        theoreticalLabel: "vâ‚€ teorico:",
        actualLabel: "vâ‚€ applicato:",
        landingLabel: "Punto di atterraggio:",
        victoryBtnText: "MISSIONE COMPLETATA!",
        retryBtnText: "RIPROVA",
        briefingLabel1: "GravitÃ  Marte",
        briefingLabel2: "Altezza Scogliera",
        briefingLabel3: "Distanza Grotta",
        briefingLabel4: "Precisione Target",
        footerInfo: "Marte â€” Valles Marineris | g = 3.71 m/sÂ²",
        cinematicScene: `
          <div class="scene-direction">[Marte â€” 6 mesi dopo la partenza dalla Terra]</div>
          <div class="scene-dialogue">
            <span class="scene-speaker vega">COMMANDER VEGA:</span>
            <span class="scene-text">"Abbiamo trovato una <span class="ice">grotta di ghiaccio</span> â€” rifugio perfetto per la base. Ma Ã¨ alla base di una scogliera di <span class="emphasis">200 metri</span>."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker newton">NEWTON:</span>
            <span class="scene-text">"La grotta Ã¨ a <span class="emphasis">350 metri</span> orizzontalmente dal bordo. Devi lanciare i rifornimenti con la velocitÃ  giusta."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker patel">DR. PATEL:</span>
            <span class="scene-text">"Abbiamo rifornimenti per <span class="emphasis">un tentativo</span>. Se manchi, li perdiamo per sempre."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker player">TU:</span>
            <span class="scene-text">"x = vâ‚€Â·t, y = Â½gtÂ²... Con g = 3.71 m/sÂ² su Marte, il tempo di volo Ã¨..."</span>
          </div>
        `,
        dialogueReady: "Moto parabolico: il moto orizzontale Ã¨ <span class='highlight'>indipendente</span> da quello verticale!",
        dialogueFlying: "Cargo in volo! La traiettoria parabolica Ã¨ bellissima...",
        dialogueSuccess: "Lancio perfetto! I rifornimenti sono nella grotta!",
        dialogueFail: "Rifornimenti mancati! Persi per sempre...",
        dialogueClose: "Quasi! Calcolo un po' piÃ¹ preciso la prossima volta.",
        dialogueHint: "Passo 1: Trova il tempo di volo con t = âˆš(2h/g). Passo 2: Calcola vâ‚€ = d/t. Hai tutti i dati!",
        resultGold: "LANCIO PERFETTO!",
        resultSilver: "BUON LANCIO!",
        resultBronze: "LANCIO RIUSCITO",
        resultFail: "LANCIO FALLITO",
        endSuccess: `
          <div class="scene-direction">[Grotta di Ghiaccio â€” Rifornimenti atterrati]</div>
          <div class="scene-dialogue">
            <span class="scene-speaker newton">NEWTON:</span>
            <span class="scene-text">"Impatto riuscito. I rifornimenti sono nella grotta. Ãˆ stato... notevolmente preciso."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker vega">COMMANDER VEGA:</span>
            <span class="scene-text">"Calculator... Alex... senza di te, saremmo morti tre volte. La fisica ci ha salvato la vita."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker patel">DR. PATEL:</span>
            <span class="scene-text">"Ti devo due pasti ora. Li avrai quando costruiremo la base."</span>
          </div>
        `,
        endFail: `
          <div class="scene-direction">[Scogliera â€” Rifornimenti persi]</div>
          <div class="scene-dialogue">
            <span class="scene-speaker newton">NEWTON:</span>
            <span class="scene-text">"I rifornimenti non hanno raggiunto il bersaglio. Stato: distrutti."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker patel">DR. PATEL:</span>
            <span class="scene-text">"Quelli erano i nostri unici rifornimenti... dovremo trovare un'altra soluzione."</span>
          </div>
          <div class="scene-dialogue">
            <span class="scene-speaker vega">COMMANDER VEGA:</span>
            <span class="scene-text">"Riprova. La fisica Ã¨ la stessa. Solo i calcoli cambiano."</span>
          </div>
        `
      },
      es: {
        introTitle: "LANZAMIENTO DE CARGA EN MARTE", headerTitle: "LANZAMIENTO DE CARGA", startBtnText: "INICIAR", backText: "ATRÃS",
        attemptsLabel: "INTENTOS", scoreLabel: "PUNTOS",
        heightLabel: "Altura (h):", distanceLabel: "Distancia (d):", timeLabel: "Tiempo vuelo:",
        velocityLabel: "Velocidad inicial (vâ‚€):", launchBtnText: "LANZAR CARGA", resetBtnText: "REINICIAR", hintBtnText: "PISTA (-5)",
        dialogueReady: "Calcula la velocidad inicial para el lanzamiento horizontal!",
        dialogueHint: "Paso 1: Encuentra t con t = âˆš(2h/g). Paso 2: Calcula vâ‚€ = d/t. Â¡Tienes todos los datos!",
        dialogueSuccess: "Â¡Impacto perfecto!", dialogueFail: "Â¡FallÃ³ el objetivo!",
        resultGold: "Â¡ENTREGA PERFECTA!", resultFail: "MISIÃ“N FALLIDA",
        footerInfo: "Marte â€” Valles Marineris | g = 3.71 m/sÂ²"
      },
      de: {
        introTitle: "MARS FRACHTABWURF", headerTitle: "FRACHTABWURF", startBtnText: "START", backText: "ZURÃœCK",
        attemptsLabel: "VERSUCHE", scoreLabel: "PUNKTE",
        heightLabel: "HÃ¶he (h):", distanceLabel: "Entfernung (d):", timeLabel: "Flugzeit:",
        velocityLabel: "Anfangsgeschwindigkeit (vâ‚€):", launchBtnText: "FRACHT ABWERFEN", resetBtnText: "NEUSTART", hintBtnText: "HINWEIS (-5)",
        dialogueReady: "Berechne die Anfangsgeschwindigkeit fÃ¼r den horizontalen Wurf!",
        dialogueHint: "Schritt 1: Finde t mit t = âˆš(2h/g). Schritt 2: Berechne vâ‚€ = d/t. Du hast alle Daten!",
        dialogueSuccess: "Perfekter Treffer!", dialogueFail: "Ziel verfehlt!",
        resultGold: "PERFEKTE LIEFERUNG!", resultFail: "MISSION FEHLGESCHLAGEN",
        footerInfo: "Mars â€” Valles Marineris | g = 3.71 m/sÂ²"
      },
      fr: {
        introTitle: "LARGAGE DE CARGO SUR MARS", headerTitle: "LARGAGE CARGO", startBtnText: "DÃ‰MARRER", backText: "RETOUR",
        attemptsLabel: "ESSAIS", scoreLabel: "SCORE",
        heightLabel: "Hauteur (h):", distanceLabel: "Distance (d):", timeLabel: "Temps de vol:",
        velocityLabel: "Vitesse initiale (vâ‚€):", launchBtnText: "LARGUER CARGO", resetBtnText: "RECOMMENCER", hintBtnText: "INDICE (-5)",
        dialogueReady: "Calcule la vitesse initiale pour le lancer horizontal!",
        dialogueHint: "Ã‰tape 1: Trouve t avec t = âˆš(2h/g). Ã‰tape 2: Calcule vâ‚€ = d/t. Tu as toutes les donnÃ©es!",
        dialogueSuccess: "TouchÃ© parfait!", dialogueFail: "Objectif ratÃ©!",
        resultGold: "LIVRAISON PARFAITE!", resultFail: "MISSION Ã‰CHOUÃ‰E",
        footerInfo: "Mars â€” Valles Marineris | g = 3.71 m/sÂ²"
      },
      bg: {
        introTitle: "ĞŸĞ£Ğ¡ĞšĞĞĞ• ĞĞ Ğ¢ĞĞ’ĞĞ  ĞĞ ĞœĞĞ Ğ¡", headerTitle: "ĞŸĞ£Ğ¡ĞšĞĞĞ• Ğ¢ĞĞ’ĞĞ ", startBtnText: "Ğ¡Ğ¢ĞĞ Ğ¢", backText: "ĞĞĞ—ĞĞ”",
        attemptsLabel: "ĞĞŸĞ˜Ğ¢Ğ˜", scoreLabel: "Ğ¢ĞĞ§ĞšĞ˜",
        heightLabel: "Ğ’Ğ¸ÑĞ¾Ñ‡Ğ¸Ğ½Ğ° (h):", distanceLabel: "Ğ Ğ°Ğ·ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ (d):", timeLabel: "Ğ’Ñ€ĞµĞ¼Ğµ Ğ¿Ğ¾Ğ»ĞµÑ‚:",
        velocityLabel: "ĞĞ°Ñ‡Ğ°Ğ»Ğ½Ğ° ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ (vâ‚€):", launchBtnText: "ĞŸĞ£Ğ¡ĞĞ˜ Ğ¢ĞĞ’ĞĞ ", resetBtnText: "Ğ Ğ•Ğ¡Ğ¢ĞĞ Ğ¢", hintBtnText: "ĞŸĞĞ”Ğ¡ĞšĞĞ—ĞšĞ (-5)",
        dialogueReady: "Ğ˜Ğ·Ñ‡Ğ¸ÑĞ»Ğ¸ Ğ½Ğ°Ñ‡Ğ°Ğ»Ğ½Ğ°Ñ‚Ğ° ÑĞºĞ¾Ñ€Ğ¾ÑÑ‚ Ğ·Ğ° Ñ…Ğ¾Ñ€Ğ¸Ğ·Ğ¾Ğ½Ñ‚Ğ°Ğ»Ğ½Ğ¸Ñ Ñ…Ğ²ÑŠÑ€Ğ»ĞµĞ¹!",
        dialogueHint: "Ğ¡Ñ‚ÑŠĞ¿ĞºĞ° 1: ĞĞ°Ğ¼ĞµÑ€Ğ¸ t Ñ t = âˆš(2h/g). Ğ¡Ñ‚ÑŠĞ¿ĞºĞ° 2: Ğ˜Ğ·Ñ‡Ğ¸ÑĞ»Ğ¸ vâ‚€ = d/t. Ğ˜Ğ¼Ğ°Ñˆ Ğ²ÑĞ¸Ñ‡ĞºĞ¸ Ğ´Ğ°Ğ½Ğ½Ğ¸!",
        dialogueSuccess: "ĞŸĞµÑ€Ñ„ĞµĞºÑ‚Ğ½Ğ¾ Ğ¿Ğ¾Ğ¿Ğ°Ğ´ĞµĞ½Ğ¸Ğµ!", dialogueFail: "Ğ¦ĞµĞ»Ñ‚Ğ° Ğ¿Ñ€Ğ¾Ğ¿ÑƒÑĞ½Ğ°Ñ‚Ğ°!",
        resultGold: "ĞŸĞ•Ğ Ğ¤Ğ•ĞšĞ¢ĞĞ Ğ”ĞĞ¡Ğ¢ĞĞ’ĞšĞ!", resultFail: "ĞœĞ˜Ğ¡Ğ˜Ğ¯Ğ¢Ğ ĞŸĞ ĞĞ’ĞĞ›Ğ•ĞĞ",
        footerInfo: "ĞœĞ°Ñ€Ñ â€” Ğ’Ğ°Ğ»ĞµÑ ĞœĞ°Ñ€Ğ¸Ğ½ĞµÑ€Ğ¸Ñ | g = 3.71 m/sÂ²"
      },
      pt: {
        introTitle: "LANÃ‡AMENTO DE CARGA EM MARTE", headerTitle: "LANÃ‡AMENTO CARGA", startBtnText: "INICIAR", backText: "VOLTAR",
        attemptsLabel: "TENTATIVAS", scoreLabel: "PONTOS",
        heightLabel: "Altura (h):", distanceLabel: "DistÃ¢ncia (d):", timeLabel: "Tempo voo:",
        velocityLabel: "Velocidade inicial (vâ‚€):", launchBtnText: "LANÃ‡AR CARGA", resetBtnText: "REINICIAR", hintBtnText: "DICA (-5)",
        dialogueReady: "Calcule a velocidade inicial para o lanÃ§amento horizontal!",
        dialogueHint: "Passo 1: Encontre t com t = âˆš(2h/g). Passo 2: Calcule vâ‚€ = d/t. VocÃª tem todos os dados!",
        dialogueSuccess: "Acerto perfeito!", dialogueFail: "Alvo errado!",
        resultGold: "ENTREGA PERFEITA!", resultFail: "MISSÃƒO FALHOU",
        footerInfo: "Marte â€” Valles Marineris | g = 3.71 m/sÂ²"
      },
      fi: {
        introTitle: "MARSIN RAHTIPUDOTUS", headerTitle: "RAHTIPUDOTUS", startBtnText: "ALOITA", backText: "TAKAISIN",
        attemptsLabel: "YRITYKSET", scoreLabel: "PISTEET",
        heightLabel: "Korkeus (h):", distanceLabel: "EtÃ¤isyys (d):", timeLabel: "Lentoaika:",
        velocityLabel: "Alkunopeus (vâ‚€):", launchBtnText: "PUDOTA RAHTI", resetBtnText: "ALUSTA", hintBtnText: "VIHJE (-5)",
        dialogueReady: "Laske alkunopeus vaakaheitolle!",
        dialogueHint: "Vaihe 1: LÃ¶ydÃ¤ t kaavalla t = âˆš(2h/g). Vaihe 2: Laske vâ‚€ = d/t. Sinulla on kaikki tiedot!",
        dialogueSuccess: "TÃ¤ydellinen osuma!", dialogueFail: "Kohde ohi!",
        resultGold: "TÃ„YDELLINEN TOIMITUS!", resultFail: "TEHTÃ„VÃ„ EPÃ„ONNISTUI",
        footerInfo: "Mars â€” Valles Marineris | g = 3.71 m/sÂ²"
      }
    };

    /* ===== STATE ===== */
    let state = {
      language: 'en',
      phase: 'intro',
      attempts: 0,
      score: 100,
      hintsUsed: 0,
      cargoX: 0,
      cargoY: 0,
      cargoVx: 0,
      cargoVy: 0,
      time: 0,
      initialVelocity: 0,
      landingX: 0,
      success: false,
      trail: [], // Store positions for drawing path AFTER dropping
      GRAVITY: 3.71,
      CLIFF_HEIGHT: 200,
      TARGET_DISTANCE: 350,
      TARGET_WIDTH: 20,
      PPM: 2
    };

    const $ = id => document.getElementById(id);
    const $$ = sel => document.querySelectorAll(sel);
    const canvas = $('gameCanvas');
    const ctx = canvas.getContext('2d');

    function t(key) { return I18N[state.language][key] || I18N.el[key] || key; }

    function setLanguage(lang) {
      state.language = lang;
      $$('.lang-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.lang === lang));
      $$('.lang-option').forEach(opt => opt.classList.toggle('active', opt.dataset.lang === lang));
      updateAllText();
      localStorage.setItem('atlas_language', lang);
    }

    function updateAllText() {
      $('langLabel').textContent = t('langLabel');
      $('introTitle').textContent = t('introTitle');
      $('cinematicScene').innerHTML = t('cinematicScene');
      $('startBtnText').textContent = t('startBtnText');
      $('briefingLabel1').textContent = t('briefingLabel1');
      $('briefingLabel2').textContent = t('briefingLabel2');
      $('briefingLabel3').textContent = t('briefingLabel3');
      $('briefingLabel4').textContent = t('briefingLabel4');
      $('headerTitle').textContent = t('headerTitle');
      $('backText').textContent = t('backText');
      $('attemptsLabel').textContent = t('attemptsLabel');
      $('scoreLabelHeader').textContent = t('scoreLabelHeader');
      $('hintsLabel').textContent = t('hintsLabel');
      $('missionDataTitle').textContent = t('missionDataTitle');
      $('cliffLabel').textContent = t('cliffLabel');
      $('targetDistLabel').textContent = t('targetDistLabel');
      $('gravityLabel').textContent = t('gravityLabel');
      $('flightLabel').textContent = t('flightLabel');
      $('launchTitle').textContent = t('launchTitle');
      $('velocityLabel').textContent = t('velocityLabel');
      $('velocityHint').textContent = t('velocityHint');
      $('physicsTitle').textContent = t('physicsTitle');
      $('formulaNote1').textContent = t('formulaNote1');
      $('formulaNote2').textContent = t('formulaNote2');
      $('formulaNote3').textContent = t('formulaNote3');
      $('launchBtnText').textContent = t('launchBtnText');
      $('resetBtnText').textContent = t('resetBtnText');
      $('hintBtnText').textContent = t('hintBtnText');
      $('keyLaunch').textContent = t('keyLaunch');
      $('keyPause').textContent = t('keyPause');
      $('keyReset').textContent = t('keyReset');
      $('keyHint').textContent = t('keyHint');
      $('pauseTitle').textContent = t('pauseTitle');
      $('pauseSubtitle').textContent = t('pauseSubtitle');
      $('formulaP1').textContent = t('formulaP1');
      $('formulaP2').textContent = t('formulaP2');
      $('formulaP3').textContent = t('formulaP3');
      $('resumeBtnText').textContent = t('resumeBtnText');
      $('scoreStatLabel').textContent = t('scoreStatLabel');
      $('attemptsStatLabel').textContent = t('attemptsStatLabel');
      $('errorStatLabel').textContent = t('errorStatLabel');
      $('analysisTitle').textContent = t('analysisTitle');
      $('flightTimeLabel').textContent = t('flightTimeLabel');
      $('theoreticalLabel').textContent = t('theoreticalLabel');
      $('actualLabel').textContent = t('actualLabel');
      $('landingLabel').textContent = t('landingLabel');
      $('victoryBtnText').textContent = t('victoryBtnText');
      $('retryBtnText').textContent = t('retryBtnText');
      $('footerInfo').textContent = t('footerInfo');
      $('dialogueText').innerHTML = t('dialogueReady');
    }

    function resizeCanvas() {
      const wrapper = canvas.parentElement;
      canvas.width = wrapper.clientWidth;
      canvas.height = wrapper.clientHeight;
    }

    function render() {
      const W = canvas.width, H = canvas.height;
      drawMarsSky(W, H);
      drawStars(W, H);
      drawCliff(W, H);
      drawCave(W, H);
      drawRover(W, H);
      drawCargo(W, H);
      drawTrajectory(W, H);
      drawInfo(W, H);
    }

    function drawMarsSky(W, H) {
      const skyGrad = ctx.createLinearGradient(0, 0, 0, H);
      skyGrad.addColorStop(0, '#1a0a0a');
      skyGrad.addColorStop(0.5, '#2a1515');
      skyGrad.addColorStop(1, '#3a2020');
      ctx.fillStyle = skyGrad;
      ctx.fillRect(0, 0, W, H);
    }

    function drawStars(W, H) {
      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
      for (let i = 0; i < 50; i++) {
        const x = (i * 137.5) % W;
        const y = (i * 73.3) % (H * 0.4);
        ctx.beginPath();
        ctx.arc(x, y, Math.random(), 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function drawCliff(W, H) {
      const cliffX = 50;
      const cliffTopY = H * 0.3;
      const groundY = H * 0.9;
      
      const cliffGrad = ctx.createLinearGradient(cliffX, 0, cliffX + 100, 0);
      cliffGrad.addColorStop(0, '#8b4513');
      cliffGrad.addColorStop(0.5, '#c44536');
      cliffGrad.addColorStop(1, '#6b1d1d');
      
      ctx.fillStyle = cliffGrad;
      ctx.beginPath();
      ctx.moveTo(0, cliffTopY);
      ctx.lineTo(cliffX, cliffTopY);
      ctx.lineTo(cliffX + 20, cliffTopY + 50);
      ctx.lineTo(cliffX + 10, groundY);
      ctx.lineTo(0, groundY);
      ctx.closePath();
      ctx.fill();
      
      const groundGrad = ctx.createLinearGradient(0, groundY, 0, H);
      groundGrad.addColorStop(0, '#c44536');
      groundGrad.addColorStop(1, '#6b1d1d');
      ctx.fillStyle = groundGrad;
      ctx.fillRect(0, groundY, W, H - groundY);
    }

    function drawCave(W, H) {
      const groundY = H * 0.9;
      const caveX = 50 + state.TARGET_DISTANCE * state.PPM;
      const caveWidth = state.TARGET_WIDTH * state.PPM;
      
      ctx.fillStyle = '#a8dadc';
      ctx.shadowColor = '#a8dadc';
      ctx.shadowBlur = 20;
      ctx.beginPath();
      ctx.arc(caveX, groundY, caveWidth / 2, Math.PI, 0);
      ctx.fill();
      ctx.shadowBlur = 0;
      
      ctx.fillStyle = '#1a3a4a';
      ctx.beginPath();
      ctx.arc(caveX, groundY, caveWidth / 2 - 5, Math.PI, 0);
      ctx.fill();
      
      ctx.fillStyle = '#fff';
      ctx.font = '12px monospace';
      ctx.textAlign = 'center';
      ctx.fillText('ğŸ¯ CAVE', caveX, groundY + 20);
      ctx.textAlign = 'left';
    }

    function drawRover(W, H) {
      const roverX = 30;
      const roverY = H * 0.3 - 20;
      
      ctx.fillStyle = '#c49a6c';
      ctx.fillRect(roverX - 20, roverY, 40, 15);
      
      ctx.fillStyle = '#666';
      ctx.beginPath();
      ctx.arc(roverX - 12, roverY + 18, 5, 0, Math.PI * 2);
      ctx.arc(roverX + 12, roverY + 18, 5, 0, Math.PI * 2);
      ctx.fill();
      
      ctx.strokeStyle = '#888';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(roverX + 15, roverY);
      ctx.lineTo(roverX + 35, roverY - 15);
      ctx.stroke();
    }

    function drawCargo(W, H) {
      if (state.phase === 'flying' || state.phase === 'landed' || state.phase === 'crashed') {
        const screenX = 50 + state.cargoX * state.PPM;
        const screenY = H * 0.3 + state.cargoY * state.PPM;
        
        ctx.fillStyle = '#ffd60a';
        ctx.shadowColor = '#ffd60a';
        ctx.shadowBlur = 10;
        ctx.beginPath();
        ctx.arc(screenX, screenY, 10, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;
        
        ctx.fillStyle = '#000';
        ctx.font = 'bold 10px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('ğŸ“¦', screenX, screenY + 4);
        ctx.textAlign = 'left';
      }
    }

    function drawTrajectory(W, H) {
      // Only draw the trail AFTER cargo has been dropped (during 'flying' or 'ended' phase)
      // Do NOT show predicted trajectory before dropping - that would give away the answer!
      if (state.phase === 'flying' || state.phase === 'ended') {
        if (state.trail && state.trail.length > 1) {
          ctx.strokeStyle = 'rgba(255, 214, 10, 0.5)';
          ctx.lineWidth = 2;
          ctx.setLineDash([3, 3]);
          ctx.beginPath();
          ctx.moveTo(state.trail[0].x, state.trail[0].y);
          for (let i = 1; i < state.trail.length; i++) {
            ctx.lineTo(state.trail[i].x, state.trail[i].y);
          }
          ctx.stroke();
          ctx.setLineDash([]);
        }
      }
      // When ready, show only a short starting indicator, not the full trajectory
      if (state.phase === 'ready') {
        ctx.fillStyle = 'rgba(255, 214, 10, 0.5)';
        ctx.beginPath();
        ctx.arc(50, H * 0.3, 8, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function drawInfo(W, H) {
      ctx.fillStyle = '#fff';
      ctx.font = '12px monospace';
      
      ctx.fillText(`h = ${state.CLIFF_HEIGHT}m`, 10, 20);
      ctx.fillText(`d = ${state.TARGET_DISTANCE}m`, 10, 35);
      ctx.fillText(`g = ${state.GRAVITY} m/sÂ²`, 10, 50);
      
      if (state.phase === 'flying') {
        ctx.fillText(`t = ${state.time.toFixed(2)}s`, 10, 70);
        ctx.fillText(`x = ${state.cargoX.toFixed(1)}m`, 10, 85);
        ctx.fillText(`y = ${state.cargoY.toFixed(1)}m`, 10, 100);
      }
    }

    function updatePhysics(dt) {
      if (state.phase !== 'flying') return;
      
      state.time += dt;
      state.cargoVy += state.GRAVITY * dt;
      state.cargoX += state.cargoVx * dt;
      state.cargoY += state.cargoVy * dt;
      
      // Record position for trail (every few frames)
      const canvas = $('gameCanvas');
      const H = canvas.height;
      const screenX = 50 + state.cargoX * state.PPM;
      const screenY = H * 0.3 + state.cargoY * state.PPM;
      if (state.trail.length === 0 || 
          Math.abs(screenX - state.trail[state.trail.length-1].x) > 10) {
        state.trail.push({x: screenX, y: screenY});
      }
      
      $('flightValue').textContent = `${state.time.toFixed(2)} s`;
      
      if (state.cargoY >= state.CLIFF_HEIGHT) {
        state.cargoY = state.CLIFF_HEIGHT;
        state.landingX = state.cargoX;
        
        const error = Math.abs(state.landingX - state.TARGET_DISTANCE);
        
        if (error <= state.TARGET_WIDTH / 2) {
          state.phase = 'landed';
          state.success = true;
          $('dialogueText').innerHTML = error < 5 ? t('dialogueSuccess') : t('dialogueClose');
        } else {
          state.phase = 'crashed';
          state.success = false;
          $('dialogueText').innerHTML = t('dialogueFail');
        }
        
        setTimeout(showEndScreen, 1500);
      }
    }

    function startGame() {
      state.phase = 'ready';
      $('introModal').classList.add('hidden');
      $('launchBtn').disabled = false;
      $('dialogueText').innerHTML = t('dialogueReady');
    }

    function launchCargo() {
      if (state.phase !== 'ready') return;
      
      state.attempts++;
      state.initialVelocity = parseInt($('velocitySlider').value);
      
      if (state.initialVelocity <= 0) {
        $('dialogueText').innerHTML = "Î§ÏÎµÎ¹Î¬Î¶ÎµÏƒÎ±Î¹ Ï„Î±Ï‡ÏÏ„Î·Ï„Î± > 0 Î³Î¹Î± Î½Î± ÎµÎºÏ„Î¿Î¾ÎµÏÏƒÎµÎ¹Ï‚!";
        return;
      }
      
      state.cargoX = 0;
      state.cargoY = 0;
      state.cargoVx = state.initialVelocity;
      state.cargoVy = 0;
      state.time = 0;
      state.phase = 'flying';
      
      $('launchBtn').disabled = true;
      $('resetBtn').disabled = false;
      $('attemptsDisplay').textContent = state.attempts;
      $('dialogueText').innerHTML = t('dialogueFlying');
    }

    function resetGame() {
      state.phase = 'ready';
      state.cargoX = 0;
      state.cargoY = 0;
      state.time = 0;
      state.trail = []; // Clear the trail
      $('launchBtn').disabled = false;
      $('flightValue').textContent = '-- s';
      $('dialogueText').innerHTML = t('dialogueReady');
    }

    function togglePause() {
      if (state.phase === 'flying') {
        state.previousPhase = state.phase;
        state.phase = 'paused';
        $('pauseOverlay').classList.add('active');
      } else if (state.phase === 'paused') {
        state.phase = state.previousPhase;
        $('pauseOverlay').classList.remove('active');
      }
    }

    function giveHint() {
      if (state.hintsUsed >= 3) return;
      state.hintsUsed++;
      state.score = Math.max(0, state.score - 5);
      $('hintsDisplay').textContent = state.hintsUsed;
      $('scoreDisplay').textContent = state.score;
      $('dialogueText').innerHTML = t('dialogueHint');
    }

    function showEndScreen() {
      const error = Math.abs(state.landingX - state.TARGET_DISTANCE);
      const attemptScore = Math.max(0, 100 - (state.attempts - 1) * 15);
      const accuracyScore = state.success ? Math.max(0, 100 - error * 5) : 0;
      const hintPenalty = state.hintsUsed * 5;
      const finalScore = Math.round(0.7 * attemptScore + 0.3 * accuracyScore - hintPenalty);
      state.score = Math.max(0, finalScore);
      
      let medal, resultClass, resultText;
      if (!state.success) {
        medal = 'ğŸ’”'; resultClass = 'fail'; resultText = t('resultFail');
      } else if (error < 5) {
        medal = 'ğŸ¥‡'; resultClass = 'gold'; resultText = t('resultGold');
      } else if (error < 10) {
        medal = 'ğŸ¥ˆ'; resultClass = 'silver'; resultText = t('resultSilver');
      } else {
        medal = 'ğŸ¥‰'; resultClass = 'bronze'; resultText = t('resultBronze');
      }
      
      $('resultMedal').textContent = medal;
      $('resultTitle').textContent = resultText;
      $('resultTitle').className = `result-title ${resultClass}`;
      $('finalScore').textContent = state.score;
      $('finalAttempts').textContent = state.attempts;
      $('finalError').textContent = error.toFixed(1);
      
      const theoreticalTime = Math.sqrt(2 * state.CLIFF_HEIGHT / state.GRAVITY);
      const theoreticalV0 = state.TARGET_DISTANCE / theoreticalTime;
      
      $('flightTimeValue').textContent = `${theoreticalTime.toFixed(2)} s`;
      $('theoreticalV').textContent = `${theoreticalV0.toFixed(1)} m/s`;
      $('actualV').textContent = `${state.initialVelocity} m/s`;
      $('landingValue').textContent = `${state.landingX.toFixed(1)} m`;
      
      $('endCinematic').innerHTML = state.success ? t('endSuccess') : t('endFail');
      $('victoryBtn').style.display = state.success ? 'block' : 'none';
      $('endModal').classList.remove('hidden');
      
      saveProgress();
    }

    function saveProgress() {
      const error = Math.abs(state.landingX - state.TARGET_DISTANCE);
      const medal = state.success ? (error < 5 ? 'gold' : error < 10 ? 'silver' : 'bronze') : null;
      localStorage.setItem('atlas_game3_completed', state.success ? 'true' : 'false');
      localStorage.setItem('atlas_game3_medal', medal);
      localStorage.setItem('atlas_game3_score', state.score);
    }

    function victory() { window.location.href = 'martian_rover.html'; }
    function retryGame() {
      $('endModal').classList.add('hidden');
      state.attempts = 0;
      state.hintsUsed = 0;
      state.score = 100;
      $('attemptsDisplay').textContent = '0';
      $('hintsDisplay').textContent = '0';
      $('scoreDisplay').textContent = '100';
      resetGame();
    }
    function goBack() { window.location.href = 'index.html'; }

    function setupSliders() {
      $('velocitySlider').addEventListener('input', (e) => {
        $('velocityDisplay').textContent = `${e.target.value} m/s`;
      });
    }

    function setupKeyboard() {
      document.addEventListener('keydown', (e) => {
        switch(e.code) {
          case 'Space': case 'Enter': e.preventDefault(); if (state.phase === 'ready') launchCargo(); break;
          case 'KeyP': togglePause(); break;
          case 'KeyR': if (state.phase !== 'intro') resetGame(); break;
          case 'KeyH': giveHint(); break;
        }
      });
    }

    let lastTime = 0;
    function gameLoop(timestamp) {
      const dt = Math.min((timestamp - lastTime) / 1000, 0.05);
      lastTime = timestamp;
      if (state.phase !== 'paused') updatePhysics(dt);
      render();
      requestAnimationFrame(gameLoop);
    }

    function init() {
      const savedLang = localStorage.getItem('atlas_language');
      if (savedLang) setLanguage(savedLang);
      
      resizeCanvas();
      window.addEventListener('resize', resizeCanvas);
      setupSliders();
      setupKeyboard();
      
      $('startGameBtn').addEventListener('click', startGame);
      $('launchBtn').addEventListener('click', launchCargo);
      $('resetBtn').addEventListener('click', resetGame);
      $('hintBtn').addEventListener('click', giveHint);
      $('victoryBtn').addEventListener('click', victory);
      $('retryBtn').addEventListener('click', retryGame);
      
      updateAllText();
      requestAnimationFrame(gameLoop);
      console.log('ğŸ”´ MARS CARGO DROP initialized');
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
